<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>[Mod] DM Project</name>
    <code>dm_project</code>
    <version>2.3</version>
    <author>by DiMoss</author>
    <link>http://forum.opencart-russia.ru/members/dimoss.3919/</link>

    <!-- ======================================= //SYSTEM// ======================================= -->

    <!-- SYSTEM - Library - Document -->

    <file path="system/library/document.php">
        <operation>
            <search><![CDATA[
            $this->links[$href] = array(
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $this->links[$href . '_' . $rel] = array( //mod
            ]]></add>
        </operation>
    </file>

    <!-- SYSTEM - Library - Cart -->

    <file path="system/library/cart/cart.php">
        <operation>
            <search><![CDATA[
            $product_special_query = $this->db->query("SELECT price FROM " . DB_PREFIX . "product_special WHERE product_id = '" . (int)$cart['product_id'] . "' AND customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ((date_start = '0000-00-00' OR date_start < NOW()) AND (date_end = '0000-00-00' OR date_end > NOW())) ORDER BY priority ASC, price ASC LIMIT 1");
            ]]></search>
            <add position="replace"><![CDATA[
            //mod
            $product_special_query = $this->db->query("SELECT price FROM " . DB_PREFIX . "product_special WHERE product_id = '" . (int)$cart['product_id'] . "' AND customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND (logged = '0' OR logged = '" . ($this->customer->isLogged() ? 1 : 0) . "') AND ((date_start = '0000-00-00' OR date_start < NOW()) AND (date_end = '0000-00-00' OR date_end > NOW())) ORDER BY priority ASC, price ASC LIMIT 1");
            //mod
            ]]></add>
        </operation>
    </file>

    <!-- SYSTEM - Library - Log -->

    <file path="system/library/log.php">
        <operation>
            <search><![CDATA[
            fwrite($this->handle, date('Y-m-d G:i:s') . ' - ' . print_r($message, true) . "\n");
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        $message_url = $_SERVER["HTTP_HOST"].$_SERVER["REQUEST_URI"];
        fwrite($this->handle, date('Y-m-d G:i:s') . '::' . $message_url . ' - ' . print_r($message, true) . "\n");
        //mod
            ]]></add>
        </operation>
    </file>

    <!-- ======================================= //END SYSTEM// ======================================= -->




    <!-- ======================================= //ADMIN-PANEL// ======================================= -->

    <!-- *** START LANGUAGE (Admin-panel) *** -->

    <!--  0.  RU-RU/EN-GB LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/ru-ru.php">
        <operation>
            <search><![CDATA[
            $_['button_add']
            ]]></search>
            <add position="before" trim="true">
                <![CDATA[
$_['button_payment']                = 'К оплате';
                ]]>
            </add>
        </operation>
    </file>
    <file path="admin/language/en-gb/en-gb.php">
        <operation>
            <search><![CDATA[
            $_['button_add']
            ]]></search>
            <add position="before" trim="true">
                <![CDATA[
$_['button_payment']                = 'To pay';
                ]]>
            </add>
        </operation>
    </file>

    <!-- 1. CATEGORY LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/catalog/category.php">
        <operation>
            <search><![CDATA[
            $_['text_default']
            ]]>
            </search>
            <add position="after"><![CDATA[
//mod
$_['text_by_default']        = 'По умолчанию';
$_['text_status_on']         = '<i class="fa fa-play"></i> вкл.';
$_['text_status_off']        = '<i class="fa fa-pause"></i> выкл.';
$_['text_disabled']          = 'Отключено';
$_['text_not_specified']     = 'Не указан';
$_['text_category_total']    = 'Всего категорий: ';
$_['text_category_template'] = 'Категория';
$_['text_product_template']  = 'Товар';
$_['text_products_template'] = 'Товары';
$_['text_variants_template'] = 'Вариации';
$_['text_attribute_groups']  = 'Разделить';
$_['text_attribute_display'] = 'Отображать';
$_['text_manufacturer']      = 'Производитель';

//Entry
$_['entry_template']          = 'Шаблон отображения';
$_['entry_template_products'] = 'Шаблон отображения товаров';
$_['entry_template_variations'] = 'Шаблон отображения вариаций';
$_['entry_thumb_size']        = 'Размер изображений товаров в категории';
$_['entry_width']             = 'Ширина';
$_['entry_height']            = 'Высота';
$_['entry_attribute_groups']  = 'Разделить вариации на группы по атрибуту';
$_['entry_attribute_display'] = 'Отображать у вариаций значение атрибута';
$_['entry_icon']              = 'Иконка категории';
$_['entry_icon_size']         = 'Размер иконки категории';
$_['entry_add_description']   = 'Доп.описание';
$_['entry_cut']               = 'Обрезать последнее слово в имени категории';
$_['entry_search_related']    = 'Искать родственные категории по имени';
$_['entry_search_regex']      = 'Регулярное выражение для preg_replace';
$_['entry_related']           = 'Дочерние товары';

//Tab
$_['tab_parent']             = 'Родительский товаров';
$_['tab_custom_template']    = 'Шаблон отображения категории';
$_['tab_related']            = 'Дочерние товары';

//Column
$_['column_parent']          = 'Родительский товар';
$_['column_templates']       = 'Шаблоны';
$_['column_attributes']      = 'Атрибуты';
$_['column_status']          = 'Статус';

//Buttons
$_['button_shop']            = 'Посмотреть на сайте';
//mod
            ]]>
            </add>
        </operation>
    </file>
    <file path="admin/language/en-gb/catalog/category.php">
        <operation>
            <search><![CDATA[
            $_['text_default']
            ]]>
            </search>
            <add position="after"><![CDATA[
//mod
$_['text_by_default']        = 'Default';
$_['text_status_on']         = '<i class="fa fa-play"></i> on';
$_['text_status_off']        = '<i class="fa fa-pause"></i> off';
$_['text_disabled']          = 'Disabled';
$_['text_not_specified']     = 'Not specified';
$_['text_category_total']    = 'Total categories: ';
$_['text_category_template'] = 'Category';
$_['text_product_template']  = 'Product';
$_['text_products_template'] = 'Products';
$_['text_variants_template'] = 'Variation';
$_['text_attribute_groups']  = 'Split';
$_['text_attribute_display'] = 'Display';
$_['text_manufacturer']      = 'Manufacturer';

//Entry
$_['entry_template']          = 'Template';
$_['entry_template_products'] = 'Template products';
$_['entry_template_variations'] = 'Template variation';
$_['entry_thumb_size']        = 'Images size in category';
$_['entry_width']             = 'Width';
$_['entry_height']            = 'Height';
$_['entry_attribute_groups']  = 'Divide variation into groups by attribute';
$_['entry_attribute_display'] = 'Display variation of the attribute value';
$_['entry_icon']              = 'Icon';
$_['entry_icon_size']         = 'Icons size';
$_['entry_add_description']   = 'Additional description';
$_['entry_cut']               = 'Сut category name';
$_['entry_search_related']    = 'Search related categories by name';
$_['entry_search_regex']      = 'Regular expression for preg_replace';
$_['entry_related']           = 'Subsidiaries';

//Tab
$_['tab_parent']             = 'Parent product';
$_['tab_custom_template']    = 'Custom template';
$_['tab_related']            = 'Subsidiaries';

//Column
$_['column_parent']          = 'Parent product';
$_['column_templates']       = 'Templates';
$_['column_attributes']      = 'Attributes';
$_['column_status']          = 'Status';

//Buttons
$_['button_shop']            = 'View on the site';
//mod
            ]]>
            </add>
        </operation>
    </file>

    <!-- 2. PRODUCT LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/catalog/product.php">
        <operation>
            <search><![CDATA[
            $_['entry_recurring']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['entry_main_category']    = 'Главная категория';
$_['entry_thumb_size']       = 'Размер большого изображения товара';
$_['entry_logged']           = 'Для зарег-х';

$_['text_create_parent_product']  = 'Новая категория с товаром';

$_['column_sku']             = 'Артикул';
$_['column_seo_url']         = 'SEO-url';
$_['column_variant']         = 'Вариация';
//mod
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/catalog/product.php">
        <operation>
            <search><![CDATA[
            $_['entry_recurring']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['entry_main_category']    = 'Main category';
$_['entry_thumb_size']       = 'Product image size';
$_['entry_logged']           = 'For Logged';

$_['text_create_parent_product']  = 'New category with products';

$_['column_sku']             = 'Sku';
$_['column_seo_url']         = 'SEO-url';
$_['column_variant']         = 'Variation';
//mod
            ]]></add>
        </operation>
    </file>

    <!-- 3. SETTING LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/setting/setting.php">
        <operation>
            <search><![CDATA[
            $_['entry_logo']
            ]]></search>
            <add position="after" trim="true"><![CDATA[
$_['entry_logo_footer']            = 'Логотип подвала';
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/setting/setting.php">
        <operation>
            <search><![CDATA[
            $_['entry_logo']
            ]]></search>
            <add position="after" trim="true"><![CDATA[
$_['entry_logo_footer']            = 'Store Logo Footer';
            ]]></add>
        </operation>
    </file>

    <!--  5. MANUFACTURER LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[
            $_['entry_type']
            ]]>
            </search>
            <add position="after"><![CDATA[
//modd
$_['entry_manufacturer_display'] = 'Шаблон отображения';
$_['entry_thumb_width']          = 'Ширина изображений товаров';
$_['entry_thumb_height']         = 'Высота изображений товаров';

//Text
$_['text_by_default']        = 'По умолчанию';
//mod
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[
            $_['entry_type']
            ]]>
            </search>
            <add position="after"><![CDATA[
//mod
$_['entry_manufacturer_display'] = 'Template';
$_['entry_thumb_width']          = 'Image width';
$_['entry_thumb_height']         = 'Image height';

//Text
$_['text_by_default']        = 'Default';
//mod
            ]]></add>
        </operation>
    </file>

    <!--  5. COLUMN-LEFT LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/common/column_left.php">
        <operation>
            <search><![CDATA[
            $_['text_other_status']
            ]]></search>
            <add position="after"><![CDATA[
$_['text_catalog']                   = 'Каталог';
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/common/column_left.php">
        <operation>
            <search><![CDATA[
            $_['text_other_status']
            ]]></search>
            <add position="after"><![CDATA[
$_['text_catalog']                   = 'Catalog';
            ]]></add>
        </operation>
    </file>

    <!--  6. FEATURED MODULE LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/extension/module/featured.php">
        <operation>
            <search><![CDATA[
            $_['text_edit']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['text_by_default']  = 'По умолчанию';

$_['entry_heading']    = 'Название модуля является заголовком';
$_['entry_category']   = 'Отображать товары из категории';
$_['entry_display']    = 'Шаблон отображения товаров';
//mod
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/extension/module/featured.php">
        <operation>
            <search><![CDATA[
            $_['text_edit']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['text_by_default']  = 'Default';

$_['entry_heading']    = 'Module name is the title';
$_['entry_category']   = 'Show products from category';
$_['entry_display']    = 'Product display template';
//mod
            ]]></add>
        </operation>
    </file>

    <!--  7.  INFORMATION LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/catalog/information.php">
        <operation error="skip">
            <search><![CDATA[
            Отображить снизу
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            Отобразить снизу
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $_['entry_layout']
            ]]></search>
            <add position="after"><![CDATA[
//information top mod
$_['entry_bottom_help']   = 'Отобразить снизу в разделе Помощь';
$_['entry_top']           = 'Отобразить сверху';
$_['entry_product']       = 'Отобразить в товарах';

$_['help_bottom_help']    = 'Показывать в нижней части сайта (футер, подвал) в разделе Помощь';
$_['help_top']            = 'Показывать в верхней части сайта (хэдэр, шапка)';
$_['help_product']        = 'Закладки в карточке товара';
//information top mod
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/catalog/information.php">
        <operation>
            <search><![CDATA[
            $_['entry_layout']
            ]]></search>
            <add position="after"><![CDATA[
//information top mod
$_['entry_bottom_help']   = 'Bottom - Help';
$_['entry_top']           = 'Top';
$_['entry_product']       = 'Show into product card';

$_['help_bottom_help']    = 'Display in the bottom footer - Help';
$_['help_top']            = 'Display in the top header';
$_['help_product']        = 'Nav-tabs into product card';
//information top mod
            ]]></add>
        </operation>
    </file>

    <!--  8.  DESIGN LANGUAGE (Admin-panel) -->

    <file path="admin/language/ru-ru/design/layout.php">
        <operation>
            <search><![CDATA[
            $_['text_content_top']
            ]]></search>
            <add position="after"><![CDATA[
$_['text_content_middle'] = 'Центр страницы';
            ]]></add>
        </operation>
    </file>
    <file path="admin/language/en-gb/design/layout.php">
        <operation>
            <search><![CDATA[
            $_['text_content_top']    = 'Content Top';
            ]]></search>
            <add position="after"><![CDATA[
$_['text_content_middle'] = 'Content Center';
            ]]></add>
        </operation>
    </file>

    <!-- *** //END LANGUAGE (Admin-panel)// *** -->



    <!-- *** START MODEL (Admin-panel) *** -->

    <!-- 1. CATEGORY MODEL (Admin-panel) -->

    <file path="admin/model/catalog/category.php">
        <operation>
            <search><![CDATA[
            if (isset($data['image'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		if (isset($data['attribute_groups'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET attribute_groups = '" . (int)$data['attribute_groups'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['attribute_display'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET attribute_display = '" . (int)$data['attribute_display'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['manufacturer_id'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET manufacturer_id = '" . (int)$data['manufacturer_id'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['category_display'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET category_display = '" . $data['category_display'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['products_display'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET products_display = '" . $data['products_display'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['product_display'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET product_display = '" . $data['product_display'] . "' WHERE category_id = '" . (int)$category_id . "'");

		    $query = $this->db->query("SELECT product_id FROM " . DB_PREFIX . "product_to_category WHERE category_id = '" . (int)$category_id . "'");

		    $product_variant_value = $data['product_display'] ? '1' : '0';

		    foreach ($query->rows as $result) {
		        $this->db->query("UPDATE " . DB_PREFIX . "product SET variation = '" . (int)$product_variant_value . "' WHERE product_id = '" . (int)$result['product_id'] . "'");
		    }
		}

		if (isset($data['product_related'])) {
		    foreach ($data['product_related'] as $product_id) {
                $this->db->query("DELETE FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "'");
                $this->db->query("INSERT INTO " . DB_PREFIX . "product_to_category SET product_id = '" . (int)$product_id . "', category_id = '" . (int)$category_id . "', main_category = '1'");
                $this->db->query("UPDATE " . DB_PREFIX . "product SET variation = '1', status = '1' WHERE product_id = '" . (int)$product_id . "'");
            }
        }

		if (isset($data['variations_display'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET variations_display = '" . $data['variations_display'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['thumb_width']) && isset($data['thumb_height'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET thumb_width = '" . (int)$data['thumb_width'] . "', thumb_height = '" . (int)$data['thumb_height'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['icon'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET icon = '" . $this->db->escape($data['icon']) . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['icon_width'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET icon_width = '" . (int)$data['icon_width'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['icon_height'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET icon_height = '" . (int)$data['icon_height'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

	    if (isset($data['search_related'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET search_related = '" . (int)$data['search_related'] . "' WHERE category_id = '" . (int)$category_id . "'");
		}

		if (isset($data['search_regex'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "category SET search_regex = '" . $this->db->escape($data['search_regex']) . "' WHERE category_id = '" . (int)$category_id . "'");
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET category_id = '" . (int)$category_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET category_id = '" . (int)$category_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', add_description = '" . $this->db->escape($value['add_description']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $sql = "SELECT cp.category_id AS category_id, GROUP_CONCAT(cd1.name ORDER BY cp.level SEPARATOR '&nbsp;&nbsp;&gt;&nbsp;&nbsp;') AS name, c1.parent_id, c1.sort_order FROM " . DB_PREFIX . "category_path cp LEFT JOIN " . DB_PREFIX . "category c1 ON (cp.category_id = c1.category_id) LEFT JOIN " . DB_PREFIX . "category c2 ON (cp.path_id = c2.category_id) LEFT JOIN " . DB_PREFIX . "category_description cd1 ON (cp.path_id = cd1.category_id) LEFT JOIN " . DB_PREFIX . "category_description cd2 ON (cp.category_id = cd2.category_id) WHERE cd1.language_id = '" . (int)$this->config->get('config_language_id') . "' AND cd2.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            ]]></search>
            <add position="after"><![CDATA[
        if (isset($data['only_true_category'])) {
            $sql .= " AND c1.product_display = '0'"; //mod
        }
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        public function getCategoryDescriptions($category_id) {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
	public function getCategoriesByParentId($parent_id = 0) {
		$query = $this->db->query("SELECT *, (SELECT COUNT(parent_id) FROM " . DB_PREFIX . "category WHERE parent_id = c.category_id) AS children FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY c.sort_order, cd.name");

		return $query->rows;
	}

	public function editCategoryStatus($category_id, $status) {
        $this->db->query("UPDATE " . DB_PREFIX . "category SET status = '" . (int)$status . "', date_modified = NOW() WHERE category_id = '" . (int)$category_id . "'");

		$this->cache->delete('category');
    }
	//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'description'      => $result['description']
            ]]></search>
            <add position="replace"><![CDATA[
                'description'      => $result['description'],
				'add_description'  => $result['add_description'] //mod
            ]]></add>
        </operation>
    </file>

    <!-- 2. PRODUCT MODEL (Admin-panel) -->

    <file path="admin/model/catalog/product.php">
        <operation>
            <search><![CDATA[
            if (isset($data['image'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($data['thumb_width']) && isset($data['thumb_height'])) {
		    $this->db->query("UPDATE " . DB_PREFIX . "product SET thumb_width = '" . (int)$data['thumb_width'] . "', thumb_height = '" . (int)$data['thumb_height'] . "' WHERE product_id = '" . (int)$product_id . "'");
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "product_to_category SET product_id = '" . (int)$product_id . "', category_id = '" . (int)$category_id . "'");
            ]]></search>
            <add position="after" offset="2"><![CDATA[
        //mod
        if (isset($data['main_category_id']) && $data['main_category_id'] > 0) {
			$this->db->query("DELETE FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "' AND category_id = '" . (int)$data['main_category_id'] . "'");
			$this->db->query("INSERT INTO " . DB_PREFIX . "product_to_category SET product_id = '" . (int)$product_id . "', category_id = '" . (int)$data['main_category_id'] . "', main_category = '1'");
			$this->db->query("UPDATE " . DB_PREFIX . "product SET variation = '" . (int)$this->getMainCategoryInfo((int)$data['main_category_id']) . "' WHERE product_id = '" . (int)$product_id . "'");
		} elseif (isset($data['product_category'][0])) {
			$this->db->query("UPDATE " . DB_PREFIX . "product_to_category SET main_category = '1' WHERE product_id = '" . (int)$product_id . "' AND category_id = '" . (int)$data['product_category'][0] . "'");
			$this->db->query("UPDATE " . DB_PREFIX . "product SET variation = '" . (int)$this->getMainCategoryInfo((int)$data['product_category'][0]) . "' WHERE product_id = '" . (int)$product_id . "'");
		} else {
		    $this->db->query("UPDATE " . DB_PREFIX . "product SET variation = '0' WHERE product_id = '" . (int)$product_id . "'");
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "product_special SET product_id = '" . (int)$product_id . "', customer_group_id = '" . (int)$product_special['customer_group_id'] . "', priority = '" . (int)$product_special['priority'] . "', price = '" . (float)$product_special['price'] . "', date_start = '" . $this->db->escape($product_special['date_start']) . "', date_end = '" . $this->db->escape($product_special['date_end']) . "'");
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "product_special SET product_id = '" . (int)$product_id . "', customer_group_id = '" . (int)$product_special['customer_group_id'] . "', priority = '" . (int)$product_special['priority'] . "', price = '" . (float)$product_special['price'] . "', date_start = '" . $this->db->escape($product_special['date_start']) . "', date_end = '" . $this->db->escape($product_special['date_end']) . "', logged = '" . (int)$product_special['logged'] . "'");
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        public function getProductFilters($product_id) {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
    public function getMainCategoryInfo($category_id) {
        $query = $this->db->query("SELECT product_display FROM " . DB_PREFIX . "category WHERE category_id = '" . (int)$category_id . "' AND product_display <> '0'");

        return (!empty($query->row['product_display']) ? '1' : '0');
    }

	public function getProductMainCategoryId($product_id) {
		$query = $this->db->query("SELECT category_id FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "' AND main_category = '1'");

		return ($query->num_rows ? (int)$query->row['category_id'] : 0);
	}

	public function editProductStatus($product_id, $status) {
        $this->db->query("UPDATE " . DB_PREFIX . "product SET status = '" . (int)$status . "', date_modified = NOW() WHERE product_id = '" . (int)$product_id . "'");

		$this->cache->delete('product');

		return $product_id;
    }
	//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "'");
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "' ORDER by main_category DESC");
            ]]></add>
        </operation>
    </file>

    <!-- 3. MANUFACTURER MODEL (Admin-panel) -->

    <file path="admin/model/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[
            if (isset($data['image'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
    	if (isset($data['manufacturer_display'])) {
    	    $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET manufacturer_display = '" . $data['manufacturer_display'] . "' WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
    	}

    	if (isset($data['thumb_width']) && isset($data['thumb_height'])) {
    	    $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET thumb_width = '" . (int)$data['thumb_width'] . "', thumb_height = '" . (int)$data['thumb_height'] . "' WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
    	}
    	//mod
            ]]></add>
        </operation>
    </file>

    <!-- 4. INFORMATION MODEL (Admin-panel) -->

    <file path="admin/model/catalog/information.php">
        <operation>
            <search><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "information SET sort_order = '" . (int)$data['sort_order'] . "', bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "', status = '" . (int)$data['status'] . "'");
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $this->db->query("INSERT INTO " . DB_PREFIX . "information SET sort_order = '" . (int)$data['sort_order'] . "', top = '" . (isset($data['top']) ? (int)$data['top'] : 0) . "', bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "', bottom_help = '" . (isset($data['bottom_help']) ? (int)$data['bottom_help'] : 0) . "', product = '" . (isset($data['product']) ? (int)$data['product'] : 0) . "', status = '" . (int)$data['status'] . "'");
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->db->query("UPDATE " . DB_PREFIX . "information SET sort_order = '" . (int)$data['sort_order'] . "', bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "', status = '" . (int)$data['status'] . "' WHERE information_id = '" . (int)$information_id . "'");
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $this->db->query("UPDATE " . DB_PREFIX . "information SET sort_order = '" . (int)$data['sort_order'] . "', top = '" . (isset($data['top']) ? (int)$data['top'] : 0) . "', bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "', bottom_help = '" . (isset($data['bottom_help']) ? (int)$data['bottom_help'] : 0) . "', product = '" . (isset($data['product']) ? (int)$data['product'] : 0) . "', status = '" . (int)$data['status'] . "' WHERE information_id = '" . (int)$information_id . "'");
            ]]></add>
        </operation>
    </file>

    <!-- 5. REPORT-SALE MODEL (Admin-panel) -->

    <file path="admin/model/report/sale.php">
        <operation>
            <search><![CDATA[
		    $sql = "SELECT SUM(total) AS total FROM `" . DB_PREFIX . "order` WHERE order_status_id > '0'";
            ]]></search>
            <add position="after"><![CDATA[
        $sql .= " AND order_status_id IN (" . implode(",", $this->config->get('config_complete_status')) . ") "; //mod
            ]]></add>
        </operation>
    </file>

    <!-- *** //END MODEL (Admin-panel)// *** -->



    <!-- *** START CONTROLLER (Admin-panel) *** -->

    <!-- 1. CATEGORY CONTROLLER (Admin-panel) -->

    <file path="admin/controller/catalog/category.php">
        <operation>
            <search><![CDATA[
	        private $error = array();
            ]]></search>
            <add position="after"><![CDATA[
    //mod
	private $category_id = 0;
	private $path = array();
	//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        protected function getList() {
            ]]></search>
            <add position="replace"><![CDATA[
    //mod
	protected function getList() {
        $url = '';

		$data['breadcrumbs'] = array();

		$data['breadcrumbs'][] = array(
			'text' => $this->language->get('text_home'),
			'href' => $this->url->link('common/dashboard', 'token=' . $this->session->data['token'], true)
		);

		$data['breadcrumbs'][] = array(
			'text' => $this->language->get('heading_title'),
			'href' => $this->url->link('catalog/category', 'token=' . $this->session->data['token'] . $url, true)
		);

		$data['add'] = $this->url->link('catalog/category/add', 'token=' . $this->session->data['token'] . $url, true);
		$data['delete'] = $this->url->link('catalog/category/delete', 'token=' . $this->session->data['token'] . $url, true);
		$data['repair'] = $this->url->link('catalog/category/repair', 'token=' . $this->session->data['token'] . $url, true);
		$data['enabled'] = $this->url->link('catalog/category/enable', 'token=' . $this->session->data['token'] . $url, true);
        $data['disabled'] = $this->url->link('catalog/category/disable', 'token=' . $this->session->data['token'] . $url, true);

		if (isset($this->request->get['path'])) {
			if ($this->request->get['path'] != '') {
			    $this->path = explode('_', $this->request->get['path']);
			    $this->category_id = end($this->path);
			    $this->session->data['path'] = $this->request->get['path'];
			} else {
				unset($this->session->data['path']);
			}
		} elseif (isset($this->session->data['path'])) {
		    $this->path = explode('_', $this->session->data['path']);
		    $this->category_id = end($this->path);
 		}

		$data['categories'] = $this->getCategories(0);

		$data['heading_title'] = $this->language->get('heading_title');

		$data['text_by_default'] = $this->language->get('text_by_default');
		$data['text_list'] = $this->language->get('text_list');
		$data['text_no_results'] = $this->language->get('text_no_results');
		$data['text_confirm'] = $this->language->get('text_confirm');
		$data['text_status_on'] = $this->language->get('text_status_on');
        $data['text_status_off'] = $this->language->get('text_status_off');
        $data['text_disabled'] = $this->language->get('text_disabled');
        $data['text_not_specified'] = $this->language->get('text_not_specified');
        $data['text_category_template'] = $this->language->get('text_category_template');
        $data['text_products_template'] = $this->language->get('text_products_template');
        $data['text_product_template'] = $this->language->get('text_product_template');
        $data['text_variants_template'] = $this->language->get('text_variants_template');
        $data['text_attribute_groups'] = $this->language->get('text_attribute_groups');
        $data['text_attribute_display'] = $this->language->get('text_attribute_display');
        $data['text_manufacturer'] = $this->language->get('text_manufacturer');

		$data['column_name'] = $this->language->get('column_name');
		$data['column_sort_order'] = $this->language->get('column_sort_order');
		$data['column_action'] = $this->language->get('column_action');
        $data['column_parent'] = $this->language->get('column_parent');
        $data['column_templates'] = $this->language->get('column_templates');
        $data['column_attributes'] = $this->language->get('column_attributes');
        $data['column_status'] = $this->language->get('column_status');

		$data['button_add'] = $this->language->get('button_add');
		$data['button_edit'] = $this->language->get('button_edit');
		$data['button_shop'] = $this->language->get('button_shop');
		$data['button_delete'] = $this->language->get('button_delete');
		$data['button_rebuild'] = $this->language->get('button_rebuild');
		$data['button_enable'] = $this->language->get('button_enable');
        $data['button_disable'] = $this->language->get('button_disable');

		if (isset($this->error['warning'])) {
			$data['error_warning'] = $this->error['warning'];
		} else {
			$data['error_warning'] = '';
		}

		if (isset($this->session->data['success'])) {
			$data['success'] = $this->session->data['success'];

			unset($this->session->data['success']);
		} else {
			$data['success'] = '';
		}

		if (isset($this->request->post['selected'])) {
			$data['selected'] = (array)$this->request->post['selected'];
		} else {
			$data['selected'] = array();
		}

		$category_total = $this->model_catalog_category->getTotalCategories();

		$data['results'] = $this->language->get('text_category_total') . ($category_total);
		$data['header'] = $this->load->controller('common/header');
		$data['column_left'] = $this->load->controller('common/column_left');
		$data['footer'] = $this->load->controller('common/footer');

		$this->response->setOutput($this->load->view('catalog/category_list_pro', $data));
	}

	protected function getListOriginal() { //mod
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
            $data['text_disabled'] = $this->language->get('text_disabled');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['text_by_default'] = $this->language->get('text_by_default');

        $data['tab_parent'] = $this->language->get('tab_parent');
        $data['tab_custom_template'] = $this->language->get('tab_custom_template');

        $data['entry_template'] = $this->language->get('entry_template');
        $data['entry_thumb_size'] = $this->language->get('entry_thumb_size');
        $data['entry_width'] = $this->language->get('entry_width');
        $data['entry_height'] = $this->language->get('entry_height');
        $data['entry_template_products'] = $this->language->get('entry_template_products');
        $data['entry_template_variations'] = $this->language->get('entry_template_variations');
        $data['entry_attribute_groups'] = $this->language->get('entry_attribute_groups');
        $data['entry_attribute_display'] = $this->language->get('entry_attribute_display');
        $data['entry_search_related'] = $this->language->get('entry_search_related');
        $data['entry_search_regex'] = $this->language->get('entry_search_regex');
        $data['entry_icon'] = $this->language->get('entry_icon');
        $data['entry_icon_size'] = $this->language->get('entry_icon_size');
        $data['entry_add_description'] = $this->language->get('entry_add_description');
        //mod
            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[
       		$this->load->model('tool/image');
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        if (isset($this->request->post['icon'])) {
		    $data['icon'] = $this->request->post['icon'];
		} elseif (!empty($category_info)) {
		    $data['icon'] = $category_info['icon'];
		} else {
		    $data['icon'] = '';
		}

		if (isset($this->request->post['icon_width'])) {
		    $data['icon_width'] = $this->request->post['icon_width'];
		} elseif (!empty($category_info)) {
		    $data['icon_width'] = $category_info['icon_width'];
		} else {
		    $data['icon_width'] = '';
		}

		if (isset($this->request->post['icon_height'])) {
		    $data['icon_height'] = $this->request->post['icon_height'];
		} elseif (!empty($category_info)) {
		    $data['icon_height'] = $category_info['icon_height'];
		} else {
		    $data['icon_height'] = '';
		}

		$this->load->model('tool/image');

		if (isset($this->request->post['icon']) && is_file(DIR_IMAGE . $this->request->post['icon'])) {
		    $data['icon_thumb'] = $this->model_tool_image->resize($this->request->post['icon'], 100, 100);
		} elseif (!empty($category_info) && is_file(DIR_IMAGE . $category_info['icon'])) {
		    $data['icon_thumb'] = $this->model_tool_image->resize($category_info['icon'], 100, 100);
		} else {
			$data['icon_thumb'] = $this->model_tool_image->resize('no_image.png', 100, 100);
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->load->model('design/layout');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        // Attributes
		$this->load->model('catalog/attribute');

		$data['attributes'] = $this->model_catalog_attribute->getAttributes();

		if (isset($this->request->post['attribute_groups'])) {
            $data['attribute_groups'] = $this->request->post['attribute_groups'];
        } elseif (!empty($category_info)) {
            $data['attribute_groups'] = $category_info['attribute_groups'];
        } else {
            $data['attribute_groups'] = false;
        }

        if (isset($this->request->post['attribute_display'])) {
            $data['attribute_display'] = $this->request->post['attribute_display'];
        } elseif (!empty($category_info)) {
            $data['attribute_display'] = $category_info['attribute_display'];
        } else {
            $data['attribute_display'] = false;
        }

        if (isset($this->request->post['category_display'])) {
            $data['category_display'] = $this->request->post['category_display'];
        } elseif (!empty($category_info)) {
            $data['category_display'] = $category_info['category_display'];
        } else {
            $data['category_display'] = false;
        }

        if (isset($this->request->post['products_display'])) {
		    $data['products_display'] = $this->request->post['products_display'];
		} elseif (!empty($category_info)) {
		    $data['products_display'] = $category_info['products_display'];
		} else {
		    $data['products_display'] = false;
		}

        if (isset($this->request->post['product_display'])) {
		    $data['product_display'] = $this->request->post['product_display'];
		} elseif (!empty($category_info)) {
		    $data['product_display'] = $category_info['product_display'];
		} else {
		    $data['product_display'] = false;
		}

		if (isset($this->request->post['variations_display'])) {
		    $data['variations_display'] = $this->request->post['variations_display'];
		} elseif (!empty($category_info)) {
		    $data['variations_display'] = $category_info['variations_display'];
		} else {
		    $data['variations_display'] = false;
		}

        if (isset($this->request->post['thumb_width'])) {
            $data['thumb_width'] = $this->request->post['thumb_width'];
        } elseif (!empty($category_info)) {
            $data['thumb_width'] = $category_info['thumb_width'];
        } else {
            $data['thumb_width'] = '';
        }

        if (isset($this->request->post['thumb_height'])) {
            $data['thumb_height'] = $this->request->post['thumb_height'];
        } elseif (!empty($category_info)) {
            $data['thumb_height'] = $category_info['thumb_height'];
        } else {
            $data['thumb_height'] = '';
        }

        if (isset($this->request->post['search_related'])) {
		    $data['search_related'] = $this->request->post['search_related'];
		} elseif (!empty($category_info)) {
		    $data['search_related'] = $category_info['search_related'];
		} else {
		    $data['search_related'] = false;
		}

		if (isset($this->request->post['search_regex'])) {
		    $data['search_regex'] = $this->request->post['search_regex'];
		} elseif (!empty($category_info)) {
		    $data['search_regex'] = $category_info['search_regex'];
		} else {
		    $data['search_regex'] = false;
		}


		$category_templates = glob(DIR_CATALOG . 'view/theme/'  . $this->config->get('config_theme') . '/template/custom/category/*.tpl');

        $data['category_templates'] = array();

		if ($category_templates) {
          foreach ($category_templates as $template) {
            $data['category_templates'][] = array(
                'name'  => basename($template)
            );
          }
        }

        $products_templates = glob(DIR_CATALOG . 'view/theme/'  . $this->config->get('config_theme') . '/template/custom/category/category_products/*.tpl');

        $data['products_templates'] = array();

		if ($products_templates) {
          foreach ($products_templates as $template) {
            $data['products_templates'][] = array(
                'name'  => basename($template)
            );
          }
        }

		$product_templates = glob(DIR_CATALOG . 'view/theme/' . $this->config->get('config_theme') . '/template/custom/product/*.tpl');

        $data['product_templates'] = array();

        if ($product_templates) {
          foreach ($product_templates as $template) {
            $data['product_templates'][] = array(
                'name'  => basename($template)
            );
          }
        }

        $variations_templates = glob(DIR_CATALOG . 'view/theme/' . $this->config->get('config_theme') . '/template/custom/product/product_variants/*.tpl');

        $data['variations_templates'] = array();

        if ($variations_templates) {
          foreach ($variations_templates as $template) {
            $data['variations_templates'][] = array(
                'name'  => basename($template)
            );
          }
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        protected function validateForm() {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
	private function getCategories($parent_id, $parent_path = '', $indent = 0) {
		$category_id = array_shift($this->path);

		$output = array();

		static $href_category = null;
		static $href_action = null;

		if ($href_category === null) {
			$href_category = $this->url->link('catalog/category', 'token=' . $this->session->data['token'] . '&path=', true);
			$href_action = $this->url->link('catalog/category/update', 'token=' . $this->session->data['token'] . '&category_id=', true);
		}

		$results = $this->model_catalog_category->getCategoriesByParentId($parent_id);

		foreach ($results as $result) {
			$path = $parent_path . $result['category_id'];

			$href = ($result['children']) ? $href_category . $path : '';

			$name = $result['name'];

			if ($category_id == $result['category_id']) {
				$name = '<b>' . $name . '</b>';

				$data['breadcrumbs'][] = array(
					'text'      => $result['name'],
					'href'      => $href,
					'separator' => ' :: '
			    );

				$href = '';
			}

			$selected = isset($this->request->post['selected']) && in_array($result['category_id'], $this->request->post['selected']);

			$action = array();

			$action[] = array(
				'text' => $this->language->get('text_edit'),
				'href' => $href_action . $result['category_id']
			);

            $attribute_groups = array();

            if ($result['attribute_groups']) {
                $this->load->model('catalog/attribute');

                $attribute_groups = $this->model_catalog_attribute->getAttribute($result['attribute_groups']);
            }

            $attribute_display = array();

            if ($result['attribute_display']) {
                $this->load->model('catalog/attribute');

                $attribute_display = $this->model_catalog_attribute->getAttribute($result['attribute_display']);
            }

			$output[$result['category_id']] = array(
				'category_id'       => $result['category_id'],
				'name'              => $name,
                'template_category' => $result['category_display'],
                'template_products' => $result['products_display'],
                'template_product'  => $result['product_display'],
                'template_variants' => $result['variations_display'],
                'attribute_groups'  => !empty($attribute_groups['name']) ? $attribute_groups['name'] : false,
                'attribute_display' => !empty($attribute_display['name']) ? $attribute_display['name'] : false,
				'sort_order'        => $result['sort_order'],
				'edit'              => $this->url->link('catalog/category/edit', 'token=' . $this->session->data['token'] . '&category_id=' . $result['category_id'], true),
				'selected'          => $selected,
				'action'            => $action,
				'href'              => $href,
				'href_shop'         => HTTP_CATALOG . 'index.php?route=product/category&path=' . ($result['category_id']),
				'indent'            => 'margin-left:' . $indent . 'px;',
				'status'            => $result['status']
			);

			if ($category_id == $result['category_id']) {
				$output += $this->getCategories($result['category_id'], $path . '_', $indent + 15);
			}
		}

		return $output;
	}

	public function enable() {
        $this->load->language('catalog/category');
        $this->document->setTitle($this->language->get('heading_title'));
        $this->load->model('catalog/category');

        if (isset($this->request->post['selected'])) {
            foreach ($this->request->post['selected'] as $category_id) {
                $this->model_catalog_category->editCategoryStatus($category_id, 1);
            }
            $this->session->data['success'] = $this->language->get('text_success');
            $url = '';
            if (isset($this->request->get['page'])) {
                $url .= '&page=' . $this->request->get['page'];
            }
            if (isset($this->request->get['sort'])) {
                $url .= '&sort=' . $this->request->get['sort'];
            }
            if (isset($this->request->get['order'])) {
                $url .= '&order=' . $this->request->get['order'];
            }
			$this->response->redirect($this->url->link('catalog/category', 'token=' . $this->session->data['token'] . $url, true));
        }

        $this->getList();
    }

    public function disable() {
        $this->load->language('catalog/category');
        $this->document->setTitle($this->language->get('heading_title'));
        $this->load->model('catalog/category');

        if (isset($this->request->post['selected'])) {
            foreach ($this->request->post['selected'] as $category_id) {
                $this->model_catalog_category->editCategoryStatus($category_id, 0);
            }
            $this->session->data['success'] = $this->language->get('text_success');
            $url = '';
            if (isset($this->request->get['page'])) {
                $url .= '&page=' . $this->request->get['page'];
            }
            if (isset($this->request->get['sort'])) {
                $url .= '&sort=' . $this->request->get['sort'];
            }
            if (isset($this->request->get['order'])) {
                $url .= '&order=' . $this->request->get['order'];
            }
            $this->response->redirect($this->url->link('catalog/category', 'token=' . $this->session->data['token'] . $url, true));
        }

        $this->getList();
    }
    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ((utf8_strlen($value['meta_title']) < 3) || (utf8_strlen($value['meta_title']) > 255)) {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            if (utf8_strlen($value['meta_title']) > 255) { //mod
            ]]></add>
        </operation>
    </file>

    <!-- 2. PRODUCT CONTROLLER (Admin-panel) -->

    <file path="admin/controller/catalog/product.php">
        <operation>
            <search><![CDATA[
            public function index() {
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $this->document->addScript('view/javascript/service.js');
        $this->document->addStyle('/catalog/view/javascript/jquery/magnific/magnific-popup.css');
        $this->document->addScript('/catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['delete'] = $this->url->link('catalog/product/delete', 'token=' . $this->session->data['token'] . $url, true);
            ]]></search>
            <add position="after"><![CDATA[
        //mod
		$data['enabled'] = $this->url->link('catalog/product/enable', 'token=' . $this->session->data['token'] . $url, true);
        $data['disabled'] = $this->url->link('catalog/product/disable', 'token=' . $this->session->data['token'] . $url, true);
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['button_filter'] = $this->language->get('button_filter');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
		$data['button_enable'] = $this->language->get('button_enable');
        $data['button_disable'] = $this->language->get('button_disable');

        $data['text_create_parent_product'] = $this->language->get('text_create_parent_product');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['column_action'] = $this->language->get('column_action');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['column_sku'] = $this->language->get('column_sku');
        $data['column_seo_url'] = $this->language->get('column_seo_url');
        $data['column_variant'] = $this->language->get('column_variant');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    'model'      => $result['model'],
            ]]></search>
            <add position="after"><![CDATA[
				'sku'        => $result['sku'], //mod
				'variation'  => $result['variation'], //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'status'     => $result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'),
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            'status'     => $result['status'] ? '<i class="fa fa-play"></i>' : '<i class="fa fa-pause"></i>',
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['entry_recurring'] = $this->language->get('entry_recurring');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['entry_main_category'] = $this->language->get('entry_main_category');
        $data['entry_thumb_size'] = $this->language->get('entry_thumb_size');
        $data['entry_width'] = $this->language->get('entry_width');
        $data['entry_height'] = $this->language->get('entry_height');
        $data['entry_logged'] = $this->language->get('entry_logged');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    		if (isset($this->request->post['location'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->post['thumb_width'])) {
            $data['thumb_width'] = $this->request->post['thumb_width'];
        } elseif (!empty($product_info)) {
            $data['thumb_width'] = $product_info['thumb_width'];
        } else {
            $data['thumb_width'] = '';
        }

        if (isset($this->request->post['thumb_height'])) {
            $data['thumb_height'] = $this->request->post['thumb_height'];
        } elseif (!empty($product_info)) {
            $data['thumb_height'] = $product_info['thumb_height'];
        } else {
            $data['thumb_height'] = '';
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    if (isset($this->request->post['product_category'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		$data['main_category'] = array();

        if (!empty($this->request->get['product_id'])) {
		    $main_category_info = $this->model_catalog_category->getCategory($this->model_catalog_product->getProductMainCategoryId($this->request->get['product_id']));

		    if ($main_category_info) {
		        $data['main_category'] = array (
		    	    'category_id' => $main_category_info['category_id'],
		    		'name'        => ($main_category_info['path']) ? $main_category_info['path'] . ' &gt; ' . $main_category_info['name'] : $main_category_info['name']
		        );
		    }
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'price'             => $product_special['price'],
            ]]></search>
            <add position="after"><![CDATA[
				'logged'            => $product_special['logged'], //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ((utf8_strlen($value['meta_title']) < 3) || (utf8_strlen($value['meta_title']) > 255)) {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            if (utf8_strlen($value['meta_title']) > 255) {
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        protected function validateForm() {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
	public function enable() {
        $this->load->language('catalog/product');

        $this->document->setTitle($this->language->get('heading_title'));

        $this->load->model('catalog/product');

        if (isset($this->request->post['selected'])) {
            foreach ($this->request->post['selected'] as $product_id) {
                $this->model_catalog_product->editProductStatus($product_id, 1);
            }

            $this->session->data['success'] = $this->language->get('text_success');

            $url = '';

            if (isset($this->request->get['page'])) {
                $url .= '&page=' . $this->request->get['page'];
            }

            if (isset($this->request->get['sort'])) {
                $url .= '&sort=' . $this->request->get['sort'];
            }

            if (isset($this->request->get['order'])) {
                $url .= '&order=' . $this->request->get['order'];
            }

            if (isset($this->request->get['filter_category'])) {
                $url .= '&filter_category=' . $this->request->get['filter_category'];
            }

            if (isset($this->request->get['filter_manufacturer'])) {
                $url .= '&filter_manufacturer=' . $this->request->get['filter_manufacturer'];
            }

            $this->response->redirect($this->url->link('catalog/product', 'token=' . $this->session->data['token'] . $url, true));
        }

        $this->getList();
    }

    public function disable() {
        $this->load->language('catalog/product');

        $this->document->setTitle($this->language->get('heading_title'));

        $this->load->model('catalog/product');

        if (isset($this->request->post['selected'])) {
            foreach ($this->request->post['selected'] as $product_id) {
                $this->model_catalog_product->editProductStatus($product_id, 0);
            }

            $this->session->data['success'] = $this->language->get('text_success');

            $url = '';

            if (isset($this->request->get['page'])) {
                $url .= '&page=' . $this->request->get['page'];
            }

            if (isset($this->request->get['sort'])) {
                $url .= '&sort=' . $this->request->get['sort'];
            }

            if (isset($this->request->get['order'])) {
                $url .= '&order=' . $this->request->get['order'];
            }

            if (isset($this->request->get['filter_category'])) {
                $url .= '&filter_category=' . $this->request->get['filter_category'];
            }

            if (isset($this->request->get['filter_manufacturer'])) {
                $url .= '&filter_manufacturer=' . $this->request->get['filter_manufacturer'];
            }

            $this->response->redirect($this->url->link('catalog/product', 'token=' . $this->session->data['token'] . $url, true));
        }

        $this->getList();
    }
    //mod
            ]]></add>
        </operation>
    </file>

    <!-- 3. SETTING CONTROLLER (Admin-panel) -->

    <file path="admin/controller/setting/setting.php">
        <operation>
            <search><![CDATA[
		    $data['entry_logo'] = $this->language->get('entry_logo');
            ]]></search>
            <add position="after"><![CDATA[
		$data['entry_logo_footer'] = $this->language->get('entry_logo_footer');
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    if (isset($this->request->post['config_icon'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		if (isset($this->request->post['config_logo_footer'])) {
			$data['config_logo_footer'] = $this->request->post['config_logo_footer'];
		} else {
			$data['config_logo_footer'] = $this->config->get('config_logo_footer');
		}

		if (isset($this->request->post['config_logo_footer']) && is_file(DIR_IMAGE . $this->request->post['config_logo_footer'])) {
			$data['logo_footer'] = $this->model_tool_image->resize($this->request->post['config_logo_footer'], 100, 100);
		} elseif ($this->config->get('config_logo_footer') && is_file(DIR_IMAGE . $this->config->get('config_logo_footer'))) {
			$data['logo_footer'] = $this->model_tool_image->resize($this->config->get('config_logo_footer'), 100, 100);
		} else {
			$data['logo_footer'] = $this->model_tool_image->resize('no_image.png', 100, 100);
		}
		//mod
            ]]></add>
        </operation>
    </file>

    <!-- 4. MANUFACTURER CONTROLLER (Admin-panel) -->

    <file path="admin/controller/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[
		    $data['entry_name'] = $this->language->get('entry_name');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        $data['text_by_default'] = $this->language->get('text_by_default');

        $data['entry_manufacturer_display'] = $this->language->get('entry_manufacturer_display');
        $data['entry_thumb_width'] = $this->language->get('entry_thumb_width');
        $data['entry_thumb_height'] = $this->language->get('entry_thumb_height');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->load->model('tool/image');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->post['manufacturer_display'])) {
		    $data['manufacturer_display'] = $this->request->post['manufacturer_display'];
		} elseif (!empty($manufacturer_info)) {
		    $data['manufacturer_display'] = $manufacturer_info['manufacturer_display'];
		} else {
		    $data['manufacturer_display'] = false;
		}

        if (isset($this->request->post['thumb_width'])) {
            $data['thumb_width'] = $this->request->post['thumb_width'];
        } elseif (!empty($manufacturer_info)) {
            $data['thumb_width'] = $manufacturer_info['thumb_width'];
        } else {
            $data['thumb_width'] = '';
        }

        if (isset($this->request->post['thumb_height'])) {
            $data['thumb_height'] = $this->request->post['thumb_height'];
        } elseif (!empty($manufacturer_info)) {
            $data['thumb_height'] = $manufacturer_info['thumb_height'];
        } else {
            $data['thumb_height'] = '';
        }

		$manufacturer_templates = glob(DIR_CATALOG . 'view/theme/' . $this->config->get('config_theme') . '/template/custom/manufacturer/*.tpl');

        $data['manufacturer_templates'] = array();

		if ($manufacturer_templates) {
            foreach ($manufacturer_templates as $template) {
                $data['manufacturer_templates'][] = array(
                    'name'  => basename($template)
                );
            }
        }
        //mod
            ]]></add>
        </operation>
    </file>

    <!-- 5. COLUMN-LEFT CONTROLLER (Admin-panel) -->

    <file path="admin/controller/common/column_left.php">
        <operation>
            <search><![CDATA[
            $catalog = array();
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            if ($this->user->hasPermission('access', 'catalog/catalog')) {
                $catalog[] = array(
                    'name'	   => $this->language->get('text_catalog'),
                    'href'     => $this->url->link('catalog/catalog', 'token=' . $this->session->data['token'], true),
                    'children' => array()
                );
            }
            //mod
            ]]></add>
        </operation>
    </file>

    <!-- 6. FEATURED MODULE CONTROLLER (Admin-panel) -->

    <file path="admin/controller/extension/module/featured.php">
        <operation>
            <search><![CDATA[
		    $data['text_disabled'] = $this->language->get('text_disabled');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['text_disabled'] = $this->language->get('text_disabled');
        $data['text_by_default'] = $this->language->get('text_by_default');

        $data['entry_heading'] = $this->language->get('entry_heading');
        $data['entry_category'] = $this->language->get('entry_category');
        $data['entry_display'] = $this->language->get('entry_display');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    		$this->load->model('catalog/product');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->post['heading'])) {
            $data['heading'] = $this->request->post['heading'];
        } elseif (!empty($module_info)) {
            $data['heading'] = $module_info['heading'];
        } else {
            $data['heading'] = '';
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if (isset($this->request->post['limit'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        $this->load->model('catalog/category');

        $data['categories'] = array();

		$categories = $this->model_catalog_category->getCategories();

        foreach ($categories as $category) {
            $data['categories'][] = array(
                'category_id' => $category['category_id'],
                'name'        => $category['name']
            );
        }

        if (isset($this->request->post['category_selected'])) {
            $data['category_selected'] = $this->request->post['category_selected'];
        } elseif (!empty($module_info)) {
            $data['category_selected'] = $module_info['category_selected'];
        } else {
            $data['category_selected'] = '';
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
    		$data['header'] = $this->load->controller('common/header');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->post['display'])) {
            $data['display'] = $this->request->post['display'];
        } elseif (!empty($module_info)) {
            $data['display'] = $module_info['display'];
        } else {
            $data['display'] = '';
        }

		$templates = glob(DIR_CATALOG . 'view/theme/' . $this->config->get('config_theme') . '/template/custom/module/featured_*.tpl');

        $data['custom_templates'] = array();

        if ($templates) {
            foreach ($templates as $template) {
                $data['custom_templates'][] = array(
                    'name'  => basename($template)
                );
            }
        }
        //mod
            ]]></add>
        </operation>
    </file>

    <!-- 7.  INFORMATION CONTROLLER (Admin-panel) -->

    <file path="admin/controller/catalog/information.php">
        <operation>
            <search><![CDATA[
		    $data['entry_layout'] = $this->language->get('entry_layout');
            ]]></search>
            <add position="after"><![CDATA[
        //information top mod
        $data['entry_bottom_help'] = $this->language->get('entry_bottom_help');
		$data['entry_top'] = $this->language->get('entry_top');
        $data['entry_product'] = $this->language->get('entry_product');

        $data['help_bottom_help'] = $this->language->get('help_bottom_help');
		$data['help_top'] = $this->language->get('help_top');
		$data['help_product'] = $this->language->get('help_product');
		//information top mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    if (isset($this->request->post['bottom'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //information top mod
		if (isset($this->request->post['top'])) {
			$data['top'] = $this->request->post['top'];
		} elseif (!empty($information_info)) {
			$data['top'] = $information_info['top'];
		} else {
			$data['top'] = 0;
		}

		if (isset($this->request->post['bottom_help'])) {
			$data['bottom_help'] = $this->request->post['bottom_help'];
		} elseif (!empty($information_info)) {
			$data['bottom_help'] = $information_info['bottom_help'];
		} else {
			$data['bottom_help'] = 0;
		}

		if (isset($this->request->post['product'])) {
			$data['product'] = $this->request->post['product'];
		} elseif (!empty($information_info)) {
			$data['product'] = $information_info['product'];
		} else {
			$data['product'] = 0;
		}
        //information top mod
            ]]></add>
        </operation>
    </file>

    <!-- 8.  DESIGN CONTROLLER (Admin-panel) -->

    <file path="admin/controller/design/layout.php">
        <operation>
            <search><![CDATA[
		    $data['text_content_top'] = $this->language->get('text_content_top');
            ]]>
            </search>
            <add position="after"><![CDATA[
        $data['text_content_middle'] = $this->language->get('text_content_middle');
            ]]>
            </add>
        </operation>
    </file>

    <!-- 9. SALE-ORDER CONTROLLER (Admin-panel) -->

    <file path="admin/controller/sale/order.php">
        <operation>
            <search><![CDATA[
            'date_modified' => date($this->language->get('date_format_short'), strtotime($result['date_modified'])),
            ]]></search>
            <add position="replace" offset="-1"><![CDATA[
				'date_added'    => date($this->language->get('datetime_format'), strtotime($result['date_added'])), //mod
				'date_modified' => date($this->language->get('datetime_format'), strtotime($result['date_modified'])), //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['date_added'] = date($this->language->get('date_format_short'), strtotime($order_info['date_added']));
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $data['date_added'] = date($this->language->get('datetime_format'), strtotime($order_info['date_added'])); //mod
            ]]></add>
        </operation>
    </file>

    <!-- *** //END CONTROLLER (Admin-panel)// *** -->



    <!-- *** START TEMPLATE (Admin) *** -->

    <!-- 1. CATEGORY TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/catalog/category_form.tpl">
        <operation>
            <search><![CDATA[
            <li><a href="#tab-design" data-toggle="tab"><?php echo $tab_design; ?></a></li>
            ]]></search>
            <add position="after"><![CDATA[
            <li><a href="#tab-template" data-toggle="tab"><?php echo $tab_custom_template; ?></a></li>
            <li><a href="#tab-parent" data-toggle="tab"><?php echo $tab_parent; ?></a></li>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <div class="tab-pane" id="tab-design">
            ]]></search>
            <add position="before"><![CDATA[
            <div class="tab-pane" id="tab-template">
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-category-display"><?php echo $entry_template; ?></label>
                    <div class="col-sm-10">
                        <select name="category_display" id="input-category-display" class="form-control">
                        <?php if ($category_templates) { ?>
                        <?php foreach ($category_templates as $template) { ?>
                            <option <?php echo $template['name'] == $category_display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                        <?php } ?>
                        <?php } ?>
                        <option <?php  echo !$category_display ? 'selected' : false; ?> value="0" ><?php echo $text_by_default; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-products-display"><?php echo $entry_template_products; ?></label>
                    <div class="col-sm-10">
                        <select name="products_display" id="input-products-display" class="form-control">
                           <?php if ($products_templates) { ?>
                           <?php foreach ($products_templates as $template) { ?>
                               <option <?php echo $template['name'] == $products_display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                           <?php } ?>
                           <?php } ?>
                           <option <?php  echo !$products_display ? 'selected' : false; ?> value="0" ><?php echo $text_by_default; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-thumb-width"><?php echo $entry_thumb_size; ?></label>
                    <div class="col-sm-10">
                        <div class="row">
                            <div class="col-sm-6">
                                <input type="text" name="thumb_width" value="<?php echo $thumb_width; ?>" placeholder="<?php echo $entry_width; ?>" id="input-thumb-width" class="form-control" />
                            </div>
                            <div class="col-sm-6">
                                <input type="text" name="thumb_height" value="<?php echo $thumb_height; ?>" placeholder="<?php echo $entry_height; ?>" id="input-thumb-height" class="form-control" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="tab-parent">
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-product-display"><?php echo $entry_template; ?></label>
                    <div class="col-sm-10">
                        <select name="product_display" id="input-product-display" class="form-control">
                           <?php if ($product_templates) { ?>
                           <?php foreach ($product_templates as $template) { ?>
                               <option <?php echo $template['name'] == $product_display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                           <?php } ?>
                           <?php } ?>
                           <option <?php  echo !$product_display ? 'selected' : false; ?> value="0" ><?php echo $text_disabled; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-variations-display"><?php echo $entry_template_variations; ?></label>
                    <div class="col-sm-10">
                        <select name="variations_display" id="input-variations-display" class="form-control">
                           <?php if ($variations_templates) { ?>
                           <?php foreach ($variations_templates as $template) { ?>
                               <option <?php echo $template['name'] == $variations_display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                           <?php } ?>
                           <?php } ?>
                           <option <?php  echo !$variations_display ? 'selected' : false; ?> value="0" ><?php echo $text_by_default; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-attribute-groups"><?php echo $entry_attribute_groups; ?></label>
                    <div class="col-sm-10">
                        <select name="attribute_groups" id="input-attribute-groups" class="form-control">
                            <?php if ($attributes) { ?>
                            <?php foreach ($attributes as $attribute) { ?>
                                <option <?php echo $attribute['attribute_id'] == $attribute_groups ? 'selected' : false; ?> value="<?php echo $attribute['attribute_id']; ?>"><?php echo $attribute['name']; ?> (<?php echo $attribute['attribute_group']; ?>)</option>
                            <?php } ?>
                            <?php } ?>
                            <option <?php  echo !$attribute_groups ? 'selected' : false; ?> value="0"><?php echo $text_disabled; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-attribute-display"><?php echo $entry_attribute_display; ?></label>
                    <div class="col-sm-10">
                        <select name="attribute_display" id="input-attribute-display" class="form-control">
                            <?php if ($attributes) { ?>
                            <?php foreach ($attributes as $attribute) { ?>
                                <option <?php echo $attribute['attribute_id'] == $attribute_display ? 'selected' : false; ?> value="<?php echo $attribute['attribute_id']; ?>"><?php echo $attribute['name']; ?> (<?php echo $attribute['attribute_group']; ?>)</option>
                            <?php } ?>
                            <?php } ?>
                            <option <?php  echo !$attribute_display ? 'selected' : false; ?> value="0"><?php echo $text_disabled; ?></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-search-related"><?php echo $entry_search_related; ?></label>
                    <div class="col-sm-10">
                        <select name="search_related" id="input-search-related" class="form-control">
                            <?php if ($search_related) { ?>
                            <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                            <option value="0"><?php echo $text_disabled; ?></option>
                            <?php } else { ?>
                            <option value="1"><?php echo $text_enabled; ?></option>
                            <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                            <?php } ?>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-search-regex"><?php echo $entry_search_regex; ?></label>
                    <div class="col-sm-10">
                        <input type="text" name="search_regex" value="<?php echo $search_regex ? $search_regex : ''; ?>" placeholder="<?php echo $entry_search_regex; ?>" id="input-search-regex" class="form-control">
                    </div>
                </div>
            </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <input type="hidden" name="image" value="<?php echo $image; ?>" id="input-image" />
			]]></search>
            <add position="after" offset="2"><![CDATA[
              <div class="form-group">
                  <label class="col-sm-2 control-label"><?php echo $entry_icon; ?></label>
                  <div class="col-sm-10"><a href="" id="thumb-icon" data-toggle="image" class="img-thumbnail"><img src="<?php echo $icon_thumb; ?>" alt="" title="" data-placeholder="<?php echo $placeholder; ?>" /></a>
                    <input type="hidden" name="icon" value="<?php echo $icon; ?>" id="input-icon" />
                  </div>
              </div>
              <div class="form-group">
                  <label class="col-sm-2 control-label" for="input-icon-width"><?php echo $entry_icon_size; ?></label>
                  <div class="col-sm-10">
                    <div class="row">
                        <div class="col-sm-6">
                            <input type="text" name="icon_width" value="<?php echo $icon_width; ?>" placeholder="<?php echo $entry_width; ?>" id="input-icon-width" class="form-control" />
                        </div>
                        <div class="col-sm-6">
                            <input type="text" name="icon_height" value="<?php echo $icon_height; ?>" placeholder="<?php echo $entry_height; ?>" id="input-icon-height" class="form-control" />
                        </div>
                    </div>
                  </div>
              </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <textarea name="category_description[<?php echo $language['language_id']; ?>][description]" placeholder="<?php echo $entry_description; ?>" id="input-description<?php echo $language['language_id']; ?>" class="form-control summernote"><?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['description'] : ''; ?></textarea>
            ]]></search>
            <add position="after" offset="2"><![CDATA[
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-add-description<?php echo $language['language_id']; ?>"><?php echo $entry_add_description; ?></label>
                    <div class="col-sm-10">
                      <textarea name="category_description[<?php echo $language['language_id']; ?>][add_description]" placeholder="<?php echo $entry_add_description; ?>" id="input-add-description<?php echo $language['language_id']; ?>" class="form-control summernote"><?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['add_description'] : ''; ?></textarea>
                    </div>
                  </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-meta-title<?php echo $language['language_id']; ?>"><?php echo $entry_meta_title; ?></label>
            ]]></search>
            <add position="replace" offset="-1"><![CDATA[
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-title<?php echo $language['language_id']; ?>"><?php echo $entry_meta_title; ?></label>
            ]]></add>
        </operation>
    </file>

    <!-- 2. PRODUCT TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/catalog/product_list.tpl">
        <operation>
            <search><![CDATA[
            <button type="button" data-toggle="tooltip" title="<?php echo $button_delete; ?>" class="btn btn-danger" onclick="confirm('<?php echo $text_confirm; ?>') ? $('#form-product').submit() : false;"><i class="fa fa-trash-o"></i></button>
            ]]></search>
            <add position="before"><![CDATA[
        <button type="button" data-toggle="tooltip" title="<?php echo $text_create_parent_product; ?>" class="btn btn-success btn-create-parent" onclick="createParentProduct('<?php echo $token ?>'); "><i class="fa fa-plus" aria-hidden="true"></i> <?php echo $text_create_parent_product ?></button>
        <button type="button" data-toggle="tooltip" title="<?php echo $button_enable; ?>" class="btn btn-default" onclick="$('#form-product').attr('action', '<?php echo $enabled; ?>').submit()"><i class="fa fa-play"></i></button>
		<button type="button" data-toggle="tooltip" title="<?php echo $button_disable; ?>" class="btn btn-default" onclick="$('#form-product').attr('action', '<?php echo $disabled; ?>').submit()"><i class="fa fa-pause"></i></button>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <td class="text-right"><?php if ($sort == 'p.price') { ?>
            ]]></search>
            <add position="before"><![CDATA[
                  <td class="text-left"><?php echo $column_sku; ?></td>
                  <td class="text-center"><?php echo $column_variant; ?></td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <td class="text-left"><?php echo $product['model']; ?></td>
            ]]></search>
            <add position="after"><![CDATA[
                  <td class="text-left"><?php echo $product['sku']; ?></td>
                  <td class="text-center">
                    <?php echo $product['variation'] ? '<i class="fa fa-check-square-o" aria-hidden="true"></i>' : ''; ?>
                  </td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <td class="text-right"><a href="<?php echo $product['edit']; ?>" data-toggle="tooltip" title="<?php echo $button_edit; ?>" class="btn btn-primary"><i class="fa fa-pencil"></i></a></td>
            ]]></search>
            <add position="replace"><![CDATA[
                  <td class="text-right" nowrap>
                    <a href="<?php echo $product['edit']; ?>" data-toggle="tooltip" title="<?php echo $button_edit; ?>" class="btn btn-primary" onclick="event.preventDefault(); quickEditProduct('<?php echo $product['product_id']; ?>', '<?php echo $token; ?>')"><i class="fa fa-search" aria-hidden="true"></i></a>
                    <a href="<?php echo $product['edit']; ?>" data-toggle="tooltip" title="<?php echo $button_edit; ?>" class="btn btn-primary"><i class="fa fa-pencil"></i></a>
                  </td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('#button-filter').on('click', function() {
            ]]></search>
            <add position="before"><![CDATA[
$('#form-product input[type=\'checkbox\']').change(function () {
  var selected = $('#form-product').serialize();

  if (selected !== "") {
    $('button.btn-create-parent').css('display', 'block');
  } else {
    $('button.btn-create-parent').css('display', 'none');
  }
});
            ]]></add>
        </operation>
    </file>

    <file path="admin/view/template/catalog/product_form.tpl">
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-meta-title<?php echo $language['language_id']; ?>"><?php echo $entry_meta_title; ?></label>
            ]]></search>
            <add position="replace" offset="-1"><![CDATA[
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-meta-title<?php echo $language['language_id']; ?>"><?php echo $entry_meta_title; ?></label>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-sort-order"><?php echo $entry_sort_order; ?></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
              <div class="form-group">
                  <label class="col-sm-2 control-label" for="input-thumb-width"><?php echo $entry_thumb_size; ?></label>
                  <div class="col-sm-10">
                      <div class="row">
                          <div class="col-sm-6">
                              <input type="text" name="thumb_width" value="<?php echo $thumb_width; ?>" placeholder="<?php echo $entry_width; ?>" id="input-thumb-width" class="form-control" />
                          </div>
                          <div class="col-sm-6">
                              <input type="text" name="thumb_height" value="<?php echo $thumb_height; ?>" placeholder="<?php echo $entry_height; ?>" id="input-thumb-height" class="form-control" />
                          </div>
                      </div>
                  </div>
              </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="<?php echo $help_category; ?>"><?php echo $entry_category; ?></span></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
			  <div class="form-group">
				<label class="col-sm-2 control-label" for="input-main-category"><?php echo $entry_main_category; ?></label>
                <div class="col-sm-10">
                  <input type="text" name="main_category" value="" placeholder="<?php echo $entry_main_category; ?>" id="input-main-category" class="form-control" />
                  <div id="product-main-category" class="well well-sm" style="height: 60px; overflow: auto;">
                    <?php if ($main_category) { ?>
                        <div id="product-main-category<?php echo $main_category['category_id']; ?>"><i class="fa fa-minus-circle"></i> <?php echo $main_category['name']; ?>
                          <input type="hidden" name="main_category_id" value="<?php echo $main_category['category_id']; ?>" />
                        </div>
                    <?php } ?>
                  </div>
                </div>
			  </div>
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
            <td class="text-left"><?php echo $entry_date_end; ?></td>
            ]]></search>
            <add position="after"><![CDATA[
                      <td class="text-left"><?php echo $entry_logged; ?></td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <td class="text-left"><button type="button" onclick="$('#special-row<?php echo $special_row; ?>').remove();" data-toggle="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
            ]]></search>
            <add position="before"><![CDATA[
                      <td class="text-left"><select name="product_special[<?php echo $special_row; ?>][logged]" class="form-control">
                          <option value="0"><?php echo $text_disabled; ?></option>
                          <option <?php echo $product_special['logged'] ? 'selected' : false; ?> value="1"><?php echo $text_enabled; ?></option>
                      </select></td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <td colspan="5"></td>
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            <td colspan="6"></td>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	html += '  <td class="text-left" style="width: 20%;"><div class="input-group date"><input type="text" name="product_special[' + special_row + '][date_end]" value="" placeholder="<?php echo $entry_date_end; ?>" data-date-format="YYYY-MM-DD" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></td>';
            ]]></search>
            <add position="after"><![CDATA[
    html += '  <td class="text-left"><select name="product_special[' + special_row + '][logged]" class="form-control">';
    html += '      <option value="0"><?php echo $text_disabled; ?></option>';
    html += '      <option value="1"><?php echo $text_enabled; ?></option>';
    html += '  </select></td>';
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('input[name=\'filter\']').autocomplete({
            ]]></search>
            <add position="before" offset="1"><![CDATA[
//Main Category
$('input[name=\'main_category\']').autocomplete({
    'source': function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/category/autocomplete&token=<?php echo $token; ?>&filter_name=' +  encodeURIComponent(request),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item['name'],
                        value: item['category_id']
                    }
                }));
            }
        });
    },
    'select': function(item) {
        $('input[name=\'main_category\']').val('');

        $('#product-main-category' + item['value']).remove();

        $('#product-main-category').html('<div id="product-main-category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="main_category_id" value="' + item['value'] + '" /></div>');
    }
});

$('#product-main-category').delegate('.fa-minus-circle', 'click', function() {
    $(this).parent().remove();
});
            ]]></add>
        </operation>
    </file>

    <!-- 3. MANUFACTURER TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/catalog/manufacturer_form.tpl">
        <operation>
            <search><![CDATA[
            <input type="text" name="sort_order" value="<?php echo $sort_order; ?>" placeholder="<?php echo $entry_sort_order; ?>" id="input-sort-order" class="form-control" />
            ]]></search>
            <add position="after" offset="2"><![CDATA[
            <div class="form-group">
                <label class="col-sm-2 control-label" for="input-manufacturer-display"><?php echo $entry_manufacturer_display; ?></label>
                <div class="col-sm-10">
                    <select name="manufacturer_display" id="input-manufacturer-display" class="form-control">
                    <?php if ($manufacturer_templates) { ?>
                    <?php foreach ($manufacturer_templates as $template) { ?>
                        <option <?php echo $template['name'] == $manufacturer_display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                    <?php } ?>
                    <?php } ?>
                    <option <?php  echo !$manufacturer_display ? 'selected' : false; ?> value="0" ><?php echo $text_by_default; ?></option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="input-thumb-width"><?php echo $entry_thumb_width; ?></label>
                <div class="col-sm-10">
                    <input type="text" name="thumb_width" value="<?php echo $thumb_width; ?>" placeholder="<?php echo $entry_thumb_width; ?>" id="input-thumb-width" class="form-control" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="input-thumb-height"><?php echo $entry_thumb_height; ?></label>
                <div class="col-sm-10">
                    <input type="text" name="thumb_height" value="<?php echo $thumb_height; ?>" placeholder="<?php echo $entry_thumb_height; ?>" id="input-thumb-height" class="form-control" />
                </div>
            </div>
            ]]></add>
        </operation>
    </file>

    <!-- 4. SETTING TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/setting/setting.tpl">
        <operation>
            <search><![CDATA[
            <input type="hidden" name="config_logo" value="<?php echo $config_logo; ?>" id="input-logo" />
            ]]></search>
            <add position="after" offset="2"><![CDATA[
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-logo-footer"><?php echo $entry_logo_footer; ?></label>
                <div class="col-sm-10"><a href="" id="thumb-logo-footer" data-toggle="image" class="img-thumbnail"><img src="<?php echo $logo_footer; ?>" alt="" title="" data-placeholder="<?php echo $placeholder; ?>" /></a>
                  <input type="hidden" name="config_logo_footer" value="<?php echo $config_logo_footer; ?>" id="input-logo-footer" />
                </div>
              </div>
            ]]></add>
        </operation>
    </file>

    <!-- 4. FEATURED MODULE TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/extension/module/featured.tpl">
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-product"><span data-toggle="tooltip" title="<?php echo $help_product; ?>"><?php echo $entry_product; ?></span></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
          <div class="form-group">
              <label class="col-sm-2 control-label" for="input-heading"><?php echo $entry_heading; ?></label>
              <div class="col-sm-10">
                  <select name="heading" id="input-heading" class="form-control">
                  <?php if ($heading) { ?>
                      <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                      <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                      <option value="1"><?php echo $text_enabled; ?></option>
                      <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                  </select>
              </div>
          </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-limit"><?php echo $entry_limit; ?></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
          <div class="form-group">
              <label class="col-sm-2 control-label" for="input-category"><?php echo $entry_category; ?></label>
              <div class="col-sm-10">
                  <select name="category_selected" id="input-category" class="form-control">
                  <?php if ($categories) { ?>
                    <?php foreach ($categories as $category) { ?>
                      <option <?php echo $category['category_id'] == $category_selected ? 'selected' : false; ?> value="<?echo $category['category_id']; ?>"><?php echo $category['name']; ?></option>
                    <?php } ?>
                  <?php } ?>
                  <option <?php echo !$category_selected ? 'selected' : false; ?> value="0"><?php echo $text_disabled; ?></option>
                  </select>
              </div>
          </div>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-status"><?php echo $entry_status; ?></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
          <div class="form-group">
              <label class="col-sm-2 control-label" for="input-display"><?php echo $entry_display; ?></label>
              <div class="col-sm-10">
                  <select name="display" id="input-display" class="form-control">
                  <?php if ($custom_templates) { ?>
                  <?php foreach ($custom_templates as $template) { ?>
                      <option <?php echo $template['name'] == $display ? 'selected' : false; ?> value="<?php echo $template['name']; ?>"><?php echo $template['name']; ?></option>
                  <?php } ?>
                  <?php } ?>
                  <option <?php  echo !$display ? 'selected' : false; ?> value="0" ><?php echo $text_by_default; ?></option>
                </select>
              </div>
          </div>
            ]]></add>
        </operation>
    </file>

    <!-- 5. INFORMATION TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/catalog/information_form.tpl">
        <operation>
            <search><![CDATA[
            <label class="col-sm-2 control-label" for="input-status"><?php echo $entry_status; ?></label>
            ]]></search>
            <add position="before" offset="1"><![CDATA[
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-bottom-help"><span data-toggle="tooltip" title="<?php echo $help_bottom_help; ?>"><?php echo $entry_bottom_help; ?></span></label>
                <div class="col-sm-10">
                  <div class="checkbox">
                    <label>
                      <?php if ($bottom_help) { ?>
                      <input type="checkbox" name="bottom_help" value="1" checked="checked" id="input-bottom-help" />
                      <?php } else { ?>
                      <input type="checkbox" name="bottom_help" value="1" id="input-bottom-help" />
                      <?php } ?>
                      &nbsp; </label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-top"><span data-toggle="tooltip" title="<?php echo $help_top; ?>"><?php echo $entry_top; ?></span></label>
                <div class="col-sm-10">
                  <div class="checkbox">
                    <label>
                      <?php if ($top) { ?>
                      <input type="checkbox" name="top" value="1" checked="checked" id="input-top" />
                      <?php } else { ?>
                      <input type="checkbox" name="top" value="1" id="input-top" />
                      <?php } ?>
                      &nbsp; </label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-product"><span data-toggle="tooltip" title="<?php echo $help_product; ?>"><?php echo $entry_product; ?></span></label>
                <div class="col-sm-10">
                  <div class="checkbox">
                    <label>
                      <?php if ($product) { ?>
                      <input type="checkbox" name="product" value="1" checked="checked" id="input-product" />
                      <?php } else { ?>
                      <input type="checkbox" name="product" value="1" id="input-product" />
                      <?php } ?>
                      &nbsp; </label>
                  </div>
                </div>
              </div>
            ]]></add>
        </operation>
    </file>

    <!-- 5. DESIGN TEMPLATE (Admin-panel) -->

    <file path="admin/view/template/design/layout_form.tpl">
        <operation>
            <search><![CDATA[
            <table id="module-content-bottom" class="table table-striped table-bordered table-hover">
            ]]></search>
            <add position="before"><![CDATA[
                <table id="module-content-middle" class="table table-striped table-bordered table-hover">
                  <thead>
                  <tr>
                    <td class="text-center"><?php echo $text_content_middle; ?></td>
                  </tr>
                  </thead>
                  <tbody>
                  <?php foreach ($layout_modules as $layout_module) { ?>
                  <?php if ($layout_module['position'] == 'content_middle') { ?>
                  <tr id="module-row<?php echo $module_row; ?>">
                    <td class="text-left"><div class="input-group">
                        <select name="layout_module[<?php echo $module_row; ?>][code]" class="form-control input-sm">
                          <?php foreach ($extensions as $extension) { ?>
                          <optgroup label="<?php echo $extension['name']; ?>">
                            <?php if (!$extension['module']) { ?>
                            <?php if ($extension['code'] == $layout_module['code']) { ?>
                            <option value="<?php echo $extension['code']; ?>" selected="selected"><?php echo $extension['name']; ?></option>
                            <?php } else { ?>
                            <option value="<?php echo $extension['code']; ?>"><?php echo $extension['name']; ?></option>
                            <?php } ?>
                            <?php } else { ?>
                            <?php foreach ($extension['module'] as $module) { ?>
                            <?php if ($module['code'] == $layout_module['code']) { ?>
                            <option value="<?php echo $module['code']; ?>" selected="selected"><?php echo $module['name']; ?></option>
                            <?php } else { ?>
                            <option value="<?php echo $module['code']; ?>"><?php echo $module['name']; ?></option>
                            <?php } ?>
                            <?php } ?>
                            <?php } ?>
                          </optgroup>
                          <?php } ?>
                        </select>
                        <input type="hidden" name="layout_module[<?php echo $module_row; ?>][position]" value="<?php echo $layout_module['position']; ?>" />
                        <input type="hidden" name="layout_module[<?php echo $module_row; ?>][sort_order]" value="<?php echo $layout_module['sort_order']; ?>" />
                        <div class="input-group-btn"><a href="<?php echo $layout_module['edit']; ?>" type="button" data-toggle="tooltip" title="<?php echo $button_edit; ?>" target="_blank" class="btn btn-primary btn-sm"><i class="fa fa-pencil"></i></a>
                          <button type="button" onclick="$('#module-row<?php echo $module_row; ?>').remove();" data-toggle="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger btn-sm"><i class="fa fa fa-minus-circle"></i></button>
                        </div>
                      </div></td>
                  </tr>
                  <?php $module_row++; ?>
                  <?php } ?>
                  <?php } ?>
                  </tbody>
                  <tfoot>
                  <tr>
                    <td class="text-left"><div class="input-group">
                        <select class="form-control input-sm">
                          <?php foreach ($extensions as $extension) { ?>
                          <optgroup label="<?php echo $extension['name']; ?>">
                            <?php if (!$extension['module']) { ?>
                            <option value="<?php echo $extension['code']; ?>"><?php echo $extension['name']; ?></option>
                            <?php } else { ?>
                            <?php foreach ($extension['module'] as $module) { ?>
                            <option value="<?php echo $module['code']; ?>"><?php echo $module['name']; ?></option>
                            <?php } ?>
                            <?php } ?>
                          </optgroup>
                          <?php } ?>
                        </select>
                        <div class="input-group-btn">
                          <button type="button" onclick="addModule('content-middle');" data-toggle="tooltip" title="<?php echo $button_module_add; ?>" class="btn btn-primary btn-sm"><i class="fa fa-plus-circle"></i></button>
                        </div>
                      </div></td>
                  </tr>
                  </tfoot>
                </table>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('#module-column-left, #module-column-right, #module-content-top, #module-content-bottom').delegate('select[name*=\'code\']', 'change', function() {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
$('#module-column-left, #module-column-right, #module-content-top, #module-content-bottom, #module-content-middle').delegate('select[name*=\'code\']', 'change', function() {
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('#module-column-left, #module-column-right, #module-content-top, #module-content-bottom').trigger('change');
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
$('#module-column-left, #module-column-right, #module-content-top, #module-content-bottom, #module-content-middle').trigger('change');
            ]]></add>
        </operation>
    </file>

    <!-- *** //END TEMPLATE (Admin-panel)// *** -->

    <!-- ======================================= //END ADMIN-PANEL// ======================================= -->




    <!-- ======================================= //FRONTEND// ======================================= -->

    <!-- *** START LANGUAGE (Frontend) *** -->

    <!-- 1. RU-RU/EN-GB LANGUAGE (Frontend) -->

    <file path="catalog/language/ru-ru/ru-ru.php">
        <operation>
            <search><![CDATA[
            $_['error_curl']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['text_reset']                = 'Сбросить все фильтры';
$_['text_stock']                = 'Наличие:';
$_['text_discount']             = ' или более: ';
$_['text_points']               = 'Цена в бонусных баллах:';
$_['text_to_manufacturer_page'] = 'На страницу производителя';
$_['text_filter_manufacturer']  = 'Отфильтровать по производителю';
$_['text_special_logged']       = 'Скидка для зарегистрированных: <span>%s</span>';
$_['text_open_map']             = 'Открыть карту';
$_['text_close_map']            = 'Закрыть карту';
$_['text_contacts']             = 'Контакты';

$_['entry_in_stock']            = 'только в наличии';

$_['button_pre_order']          = 'Под заказ';
$_['button_no_stock']           = 'Нет в наличии';
$_['button_payment']            = 'Оплатить заказ';
$_['button_invoice_download']   = 'Скачать счет на оплату';

$_['tab_description']           = 'Описание';
//mod
            ]]></add>
        </operation>
    </file>
    <file path="catalog/language/en-gb/en-gb.php">
        <operation>
            <search><![CDATA[
            $_['error_curl']
            ]]></search>
            <add position="after"><![CDATA[
//mod
$_['text_reset']                = 'Reset all filters';
$_['text_stock']                = 'Availability:';
$_['text_discount']             = ' or more ';
$_['text_points']               = 'Price in reward points:';
$_['text_to_manufacturer_page'] = 'To manufacturer page';
$_['text_filter_manufacturer']  = 'Filter manufacturer';
$_['text_special_logged']       = 'Discount for registered users: <span>%s</span>';
$_['text_open_map']             = 'Open a map';
$_['text_close_map']            = 'Close a map';
$_['text_contacts']             = 'Contacts';

$_['entry_in_stock']            = 'in stock';

$_['button_pre_order']          = 'Pre-order';
$_['button_no_stock']           = 'Not available';
$_['button_payment']            = 'Pay an order';
$_['button_invoice_download']   = 'Download invoice';

$_['tab_description']           = 'Description';
//mod
            ]]></add>
        </operation>
    </file>

    <!-- 1.1 PRODUCT LANGUAGE (Frontend) -->

    <file path="catalog/language/ru-ru/product/product.php">
        <operation>
            <search><![CDATA[
            $_['text_login']                              = 'Пожалуйста <a href="%s">авторизируйтесь</a> или <a href="%s">создайте учетную запись</a> перед тем как написать отзыв';
            ]]></search>
            <add position="after" trim="true"><![CDATA[
$_['text_login_ajax']                         = 'Пожалуйста <button type="button" onclick="%s"><strong>авторизируйтесь</strong></button> или <a href="%s"><strong>создайте учетную запись</strong></a> перед тем как написать отзыв';
            ]]></add>
        </operation>
    </file>

    <file path="catalog/language/en-gb/product/product.php">
        <operation>
            <search><![CDATA[
            $_['text_login']               = 'Please <a href="%s">login</a> or <a href="%s">register</a> to review';
            ]]></search>
            <add position="after" trim="true"><![CDATA[
$_['text_login_ajax']          = 'Please <button type="button" onclick="%s"><strong>login</strong></button> or <a href="%s"><strong>register</strong></a> to review';
            ]]></add>
        </operation>
    </file>

    <!-- 2. FOOTER LANGUAGE (Frontend) -->

    <file path="catalog/language/ru-ru/common/footer.php">
        <operation>
            <search><![CDATA[
            $_['text_powered']      = 'Работает на <a href="http://opencart-russia.ru">OpenCart "Русская сборка"</a><br /> %s &copy; %s';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
//mod
$_['text_catalog']      = 'Каталог';
$_['text_powered']      = '%s &copy; %s';
//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $_['text_service']      = 'Служба поддержки';
            ]]></search>
            <add position="replace" trim="true" offset="-1"><![CDATA[
//mod
$_['text_information']  = 'О нас';
$_['text_service']      = 'Помощь';
//mod
            ]]></add>
        </operation>
    </file>
    <file path="catalog/language/en-gb/common/footer.php">
        <operation>
            <search><![CDATA[
            $_['text_powered']      = 'Powered By <a href="http://www.opencart.com">OpenCart</a><br /> %s &copy; %s';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
//mod
$_['text_catalog']      = 'Catalog';
$_['text_powered']      = '%s &copy; %s';
//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $_['text_service']      = 'Customer Service';
            ]]></search>
            <add position="replace" trim="true" offset="-1"><![CDATA[
//mod
$_['text_information']  = 'About us';
$_['text_service']      = 'Help';
//mod
            ]]></add>
        </operation>
    </file>

    <!-- *** //END LANGUAGE (Frontend)// -->



    <!-- *** START MODEL (Frontend) *** -->

    <!-- 1. CATEGORY MODEL (Frontend) -->

    <file path="catalog/model/catalog/category.php">
        <operation>
            <search><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) LEFT JOIN " . DB_PREFIX . "category_to_store c2s ON (c.category_id = c2s.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND c2s.store_id = '" . (int)$this->config->get('config_store_id') . "'  AND c.status = '1' ORDER BY c.sort_order, LCASE(cd.name)");
            ]]></search>
            <add position="replace" ><![CDATA[
        //mod
        $sql = "SELECT * FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) LEFT JOIN " . DB_PREFIX . "category_to_store c2s ON (c.category_id = c2s.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND c2s.store_id = '" . (int)$this->config->get('config_store_id') . "' AND c.status = '1'";

        $sql .= " AND c.product_display = '0'";

        $sql .= " ORDER BY c.sort_order, LCASE(cd.name)";

        $query = $this->db->query($sql);
        //mod
            ]]></add>
        </operation>
    </file>

    <!-- 2. PRODUCT MODEL (Frontend) -->

    <file path="catalog/model/catalog/product.php">
        <operation>
            <search><![CDATA[
            SELECT DISTINCT *, pd.name AS name, p.image, m.name AS manufacturer,
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            SELECT DISTINCT *, pd.name AS name, p.image, m.name AS manufacturer, m.image as manufacturer_img, p.thumb_width, p.thumb_height,
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            (SELECT price FROM " . DB_PREFIX . "product_special ps WHERE ps.product_id = p.product_id AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC, ps.price ASC LIMIT 1) AS special
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            (SELECT price FROM " . DB_PREFIX . "product_special ps WHERE ps.product_id = p.product_id AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND (ps.logged = '0' OR ps.logged = '" . ($this->customer->isLogged() ? 1 : 0) . "') AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC, ps.price ASC LIMIT 1) AS special
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'manufacturer'     => $query->row['manufacturer'],
            ]]></search>
            <add position="after"><![CDATA[
                //mod
                'manufacturer_img' => $query->row['manufacturer_img'],
                //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'height'           => $query->row['height'],
            ]]></search>
            <add position="after"><![CDATA[
                //mod
                'thumb_width'      => $query->row['thumb_width'],
			    'thumb_height'     => $query->row['thumb_height'],
			    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $sql .= " LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id) LEFT JOIN " . DB_PREFIX . "product_to_store p2s ON (p.product_id = p2s.product_id) WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '" . (int)$this->config->get('config_store_id') . "'";
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        $sql .= " LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id) LEFT JOIN " . DB_PREFIX . "product_to_store p2s ON (p.product_id = p2s.product_id)";

        if (!empty($data['filter_min_price']) && !empty($data['filter_max_price'])) {
            $sql .= " LEFT JOIN " . DB_PREFIX . "product_special ps ON (p.product_id = ps.product_id)";
        }

        if (!empty($data['filter_attribute'])) {
            foreach ($data['filter_attribute'] as $key => $value) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "product_attribute pa_" . (int)$key . " ON (p.product_id = pa_" . (int)$key . ".product_id AND pa_" . (int)$key . ".attribute_id = '" . (int)$key . "')";
            }
        }

        $sql .= " WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '" . (int)$this->config->get('config_store_id') . "'";
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    if (!empty($data['filter_name']) || !empty($data['filter_tag'])) {
			]]></search>
            <add position="before"><![CDATA[
        //mod
        if (!empty($data['filter_min_price']) && !empty($data['filter_max_price'])) {
            $sql .= " AND
            (CASE
                WHEN
                    (SELECT price FROM " . DB_PREFIX . "product_special ps WHERE ps.product_id = p.product_id AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND (ps.logged = '0' OR ps.logged = '" . ($this->customer->isLogged() ? 1 : 0) . "') AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC, ps.price ASC LIMIT 1) IS NOT NULL AND p.quantity > '0'
                THEN
                    ps.price >= '" . (float)$data['filter_min_price'] . "' AND ps.price <= '" . (float)$data['filter_max_price'] . "'
                ELSE
                    p.price >= '" . (float)$data['filter_min_price'] . "' AND p.price <= '" . (float)$data['filter_max_price'] . "'
            END)";
        }

        if (isset($data['filter_in_stock']) && $data['filter_in_stock'] == true) {
            $sql .= " AND p.quantity > '0'";
        }

        if (!empty($data['filter_attribute'])) {
            foreach ($data['filter_attribute'] as $key => $value) {
                $sql .= " AND pa_" . (int)$key . ".text LIKE '%" . $this->db->escape($value) . "%'";
            }
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
			if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		if (isset($data['sort']) && $data['sort'] == 'price') {
		    $data['sort'] = 'p.price';
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
			if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		if (isset($data['sort']) && $data['sort'] == 'price') {
		    $data['sort'] = 'ps.price';
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
            $sql .= " ORDER BY p.sort_order";
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $sql .= " ORDER BY p.quantity DESC, p.sort_order";
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
	        public function getProductSpecials($data = array()) {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
	public function getProductSpecialsLogged($product_id) {
	    if ($this->customer->isLogged()) {
	        return false;
	    } else {
	        $sql = "SELECT price FROM " . DB_PREFIX . "product_special ps WHERE ps.product_id = '" . $product_id . "' AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ps.logged = '1' AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC, ps.price ASC LIMIT 1";

            $query = $this->db->query($sql);

	        return $query->row;
	    }
	}
	//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		$sql = "SELECT DISTINCT ps.product_id, (SELECT AVG(rating) FROM " . DB_PREFIX . "review r1 WHERE r1.product_id = ps.product_id AND r1.status = '1' GROUP BY r1.product_id) AS rating FROM " . DB_PREFIX . "product_special ps LEFT JOIN " . DB_PREFIX . "product p ON (ps.product_id = p.product_id) LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id) LEFT JOIN " . DB_PREFIX . "product_to_store p2s ON (p.product_id = p2s.product_id) WHERE p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '" . (int)$this->config->get('config_store_id') . "' AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) GROUP BY ps.product_id";
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
		$sql = "SELECT DISTINCT ps.product_id, (SELECT AVG(rating) FROM " . DB_PREFIX . "review r1 WHERE r1.product_id = ps.product_id AND r1.status = '1' GROUP BY r1.product_id) AS rating FROM " . DB_PREFIX . "product_special ps LEFT JOIN " . DB_PREFIX . "product p ON (ps.product_id = p.product_id) LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id) LEFT JOIN " . DB_PREFIX . "product_to_store p2s ON (p.product_id = p2s.product_id)";

		if (isset($data['filter_category_id'])) {
		    $sql .= " LEFT JOIN " . DB_PREFIX . "product_to_category p2c ON (p.product_id = p2c.product_id) LEFT JOIN " . DB_PREFIX . "category c ON (p2c.category_id = c.category_id)";
        }

        if (!empty($data['filter_min_price']) && !empty($data['filter_max_price'])) {
            $sql .= " AND ps.price >= '" . (float)$data['filter_min_price'] . "' AND ps.price <= '" . (float)$data['filter_max_price'] . "'";
        }

		$sql .= " WHERE p.status = '1' AND p.date_available <= NOW() AND p.quantity > '0' AND p2s.store_id = '" . (int)$this->config->get('config_store_id') . "' AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND (ps.logged = '0' OR ps.logged = '" . ($this->customer->isLogged() ? 1 : 0) . "') AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW()))";

        if (isset($data['filter_category_id'])) {
            $sql .= " AND c.category_id = '" . $data['filter_category_id'] . "'";
        }

		$sql .= " GROUP BY ps.product_id";
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            public function getProductAttributes($product_id) {
            ]]></search>
            <add position="before"><![CDATA[
    //mod
    public function getProductAttributeValue($data = array()) {
        $query = $this->db->query("SELECT pa.text, ad.name FROM " . DB_PREFIX . "product_attribute pa LEFT JOIN " . DB_PREFIX . "attribute_description ad ON (pa.attribute_id = ad.attribute_id) WHERE pa.product_id = '" . (int)$data['product_id'] . "' AND pa.attribute_id = '" . (int)$data['attribute_id'] . "' AND ad.language_id = '" . (int)$this->config->get('config_language_id') . "'");

        return $query->row;
    }

    public function getAttributeName($attribute_id) {
	    $query = $this->db->query("SELECT name FROM " . DB_PREFIX . "attribute_description WHERE attribute_id = '" . (int)$attribute_id . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");

	    return $query->row;
	}
	//mod
            ]]></add>
        </operation>
    </file>

    <!-- *** //END MODEL (Frontend)// *** -->



    <!-- *** START CONTROLLER (Frontend) *** -->

    <!-- 1. CATEGORY CONTROLLER (Frontend) -->

    <file path="catalog/controller/product/category.php">
        <operation>
            <search><![CDATA[
		$this->load->model('tool/image');
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        $this->load->model('catalog/manufacturer');
        $this->load->model('catalog/parent_product');

        $this->load->model('tool/image');

        $this->document->addScript('catalog/view/javascript/jquery/blueimp/js/blueimp-gallery.min.js');
        $this->document->addStyle('catalog/view/javascript/jquery/blueimp/css/blueimp-gallery.min.css');

        $this->document->addStyle('catalog/view/javascript/jquery/slick/slick.css');
		$this->document->addStyle('catalog/view/javascript/jquery/slick/slick-theme.css');
		$this->document->addScript('catalog/view/javascript/jquery/slick/slick.min.js');

        $data['popup_view_data'] = $this->config->get($this->config->get('config_theme') . '_popup_view_data');
        $data['popup_view_text'] = $this->language->load('common/popup_view');
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
		    if (isset($this->request->get['filter'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->get['in_stock'])) {
            $in_stock = $this->request->get['in_stock'];
        } else {
            $in_stock = '';
        }

        if (isset($this->request->get['manufacturer_id'])) {
            $manufacturer_id = $this->request->get['manufacturer_id'];
        } else {
            $manufacturer_id = '';
        }

        if (isset($this->request->get['min_price'])) {
            $min_price = $this->request->get['min_price'];
        } else {
            $min_price = '';
        }

        if (isset($this->request->get['max_price'])) {
            $max_price = $this->request->get['max_price'];
        } else {
            $max_price = '';
        }

        if (isset($this->request->get['attribute_filter'])) {
            $attribute_filter = $this->request->get['attribute_filter'];
        } else {
            $attribute_filter = '';
        }
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $sort = 'p.sort_order';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $sort = 'p.quantity'; //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $order = 'ASC';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $order = 'DESC'; //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0,2"><![CDATA[
            $url .= '&sort=' . $this->request->get['sort'];
            ]]></search>
            <add position="before" offset="1"><![CDATA[
            //mod
            if (isset($this->request->get['in_stock'])) {
				$in_stock_filter = '&in_stock=true';
            } else {
				$in_stock_filter = '';
			}

			if (isset($this->request->get['manufacturer_id'])) {
				$manufacturer_filter = '&manufacturer_id=' . $this->request->get['manufacturer_id'];
            } else {
				$manufacturer_filter = '';
			}
            //mod
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
            $url .= '&sort=' . $this->request->get['sort'];
            ]]></search>
            <add position="before" offset="1"><![CDATA[
            //mod
            if (isset($this->request->get['in_stock'])) {
				$in_stock_filter = '&in_stock=true';
            } else {
				$in_stock_filter = '';
			}
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['text_limit'] = $this->language->get('text_limit');
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $data['text_discount'] = $this->language->get('text_discount');
            $data['text_points'] = $this->language->get('text_points');
            $data['text_to_manufacturer_page'] = $this->language->get('text_to_manufacturer_page');
            $data['text_filter_manufacturer'] = $this->language->get('text_filter_manufacturer');
            $data['text_stock'] = $this->language->get('text_stock');
            $data['text_loading'] = $this->language->get('text_loading');
            $data['text_from'] = $this->language->get('text_from');
            $data['text_to'] = $this->language->get('text_to');
            $data['text_reward'] = $this->language->get('text_reward');

            $data['entry_in_stock'] = $this->language->get('entry_in_stock');

            $data['stock_checkout'] = $this->config->get('config_stock_checkout');
            $data['stock_display'] = $this->config->get('config_stock_display');

            $data['button_no_stock'] = $this->language->get('button_no_stock');
            $data['button_pre_order'] = $this->language->get('button_pre_order');
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$data['thumb'] = $this->model_tool_image->resize($category_info['image'], $this->config->get($this->config->get('config_theme') . '_image_category_width'), $this->config->get($this->config->get('config_theme') . '_image_category_height'));
            ]]></search>
            <add position="replace" offset="-1"><![CDATA[
            //mod
            if ($category_info['image']) {
                $thumb = $this->model_tool_image->resize($category_info['image'], getimagesize(DIR_IMAGE . $category_info['image'])[0], getimagesize(DIR_IMAGE . $category_info['image'])[1]);

                $data['thumb'] = array(
                    'thumb'      => $thumb,
                    'background' => '<div style="position: absolute; display: block; width: 100%; height: 100%; bottom: 0; opacity: 0.5; background: url(' . $thumb . ') center repeat-x;"></div>'
                ); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$data['description'] = html_entity_decode($category_info['description'], ENT_QUOTES, 'UTF-8');
            ]]></search>
            <add position="after"><![CDATA[
			$data['add_description'] = html_entity_decode($category_info['add_description'], ENT_QUOTES, 'UTF-8'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['products'] = array();
            ]]></search>
            <add position="before"><![CDATA[
            //mod
            if (!$category_info['product_display']) {
                $filter_data = array (
                    'filter_category_id'     => $category_id,
                    'filter_manufacturer_id' => $manufacturer_id,
                    'filter_in_stock'        => $in_stock,
                    'filter_min_price'       => $min_price,
                    'filter_max_price'       => $max_price,
                    'filter_attribute'       => $attribute_filter,
                    'sort'                   => $sort,
                    'order'                  => $order,
                    'start'                  => ($page - 1) * $limit,
                    'limit'                  => $limit
                );

                $data['parent_id'] = $category_id;

                $results = $this->model_catalog_parent_product->getProductsAnyType($filter_data);

                $results_total = $this->model_catalog_parent_product->getTotalProductsAnyType($filter_data);

                if ($results) {
                    $data['products_any_type'] = $this->model_catalog_parent_product->getProductsAnyTypeView($products_type = 'products_category', $results, $category_info, $url, $in_stock, $data, $filter_data);
                } else {
                    $data['products_any_type'] = false;
                }

                $data['filter_manufacturer'] = $this->load->controller('common/filter/filter_manufacturer', $filter_data);
                $data['filter_attribute'] = $this->load->controller('common/filter/filter_attribute', $filter_data);
                $data['filter_price'] = $this->load->controller('common/filter/filter_price', $filter_data);
                $data['filter_selected'] = $this->load->controller('common/filter/filter_selected', $this->request->get);
            }
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'limit'              => $limit
            ]]></search>
            <add position="replace" offset="-1"><![CDATA[
				//'start'            => ($page - 1) * $limit,
				//'limit'            => $limit
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $results = $this->model_catalog_product->getProducts($filter_data);
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $results = $category_info['product_display'] ? $this->model_catalog_product->getProducts($filter_data) : array(); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $product_total = $this->model_catalog_product->getTotalProducts($filter_data);
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $product_total = $category_info['product_display'] ? $this->model_catalog_product->getTotalProducts($filter_data) : $results_total; //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $image = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_product_width'), $this->config->get($this->config->get('config_theme') . '_image_product_height'));
            ]]></search>
            <add position="replace" offset="-3"><![CDATA[
                //mod
                $add_images = array();

			    $images_additional = $this->model_catalog_product->getProductImages($result['product_id']);

                if ($images_additional && $result['image'] && $result['thumb_width'] && $result['thumb_height']) {
                    $big_width = $result['thumb_width'];
                    $big_height = $result['thumb_height'];
                } elseif ($images_additional) {
                    $big_width = $this->config->get($this->config->get('config_theme') . '_image_product_width');
                    $big_height = $this->config->get($this->config->get('config_theme') . '_image_product_height');
                }

			    foreach ($images_additional as $image_additional) {
			    	$add_images[] = array(
			    		'popup' => $this->model_tool_image->resize($image_additional['image'], $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height')),
                        'thumb' => $this->model_tool_image->resize($image_additional['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height')),
                        'big_thumb' => $this->model_tool_image->resize($image_additional['image'], $big_width, $big_height)
			    	);
			    }

                if ($result['image'] && $category_info['thumb_width'] && $category_info['thumb_height']) {
        	    	$image = $this->model_tool_image->resize($result['image'], $category_info['thumb_width'], $category_info['thumb_height']);
        	    	$small_image = $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
        	    	$popup = $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height'));
                } elseif ($result['image']) {
                    $image = $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_product_width'), $this->config->get($this->config->get('config_theme') . '_image_product_height'));
                    $small_image = $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
                    $popup = $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height'));
                } elseif ($category_info['thumb_width'] && $category_info['thumb_height']) {
    		    	$image = $this->model_tool_image->resize('placeholder.png', $category_info['thumb_width'], $category_info['thumb_height']);
    		    	$small_image = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
    		    	$popup = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height'));
                } else {
    		    	$image = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_product_width'), $this->config->get($this->config->get('config_theme') . '_image_product_height'));
    		    	$small_image = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height')); //mod
    		    	$popup = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height'));
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
			if ((float)$result['special']) {
            ]]></search>
            <add position="replace" offset="4"><![CDATA[
                //mod
                if ((float)$result['special'] && $result['quantity'] > 0) {
					$special = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
				} else {
					$special = false;
				}

                $special_logged_info = $this->model_catalog_product->getProductSpecialsLogged($result['product_id']);

                if ($price && !empty($special_logged_info['price']) && $result['quantity'] > 0) {
                    $special_logged = sprintf($this->language->get('text_special_logged'), $this->currency->format($this->tax->calculate($price - $special_logged_info['price'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']));
                } else {
                    $special_logged = false;
                }

                if ($result['quantity'] <= 0) {
                    $product_stock = $result['stock_status'];
                } elseif ($this->config->get('config_stock_display')) {
                    $product_stock = $result['quantity'];
                } else {
				    $product_stock = $this->language->get('text_instock');
			    }

                $product_manufacturer = array();

                if ($result['manufacturer_id']) {
                    $product_manufacturer_info = $this->model_catalog_manufacturer->getManufacturer($result['manufacturer_id']);

                    if ($product_manufacturer_info) {
                        if ($product_manufacturer_info['image']) {
                            $logo = $this->model_tool_image->resize($product_manufacturer_info['image'], $this->config->get($this->config->get('config_theme') . '_manufacturer_image_thumb_width'), $this->config->get($this->config->get('config_theme') . '_manufacturer_image_thumb_height'));
                        } else {
                            $logo = false;
                        }

                        $product_manufacturer = array(
                            'name'            => $product_manufacturer_info['name'],
                            'image'           => $logo,
                            'id'              => $product_manufacturer_info['manufacturer_id'],
                            'href'            => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $product_manufacturer_info['manufacturer_id'])
                        );
                    }
                }
                //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'thumb'       => $image,
            ]]></search>
            <add position="after"><![CDATA[
                    //mod
                    'small_thumb'      => $small_image,
                    'images'           => $add_images,
					'popup'            => $popup,
                    'special_logged'   => $special_logged,
                    'stock'            => $product_stock,
                    'stock_qty'        => $result['quantity'],
					'reward'           => $result['reward'],
					'model'            => $result['model'],
					'attribute_groups' => $this->model_catalog_product->getProductAttributes($result['product_id']),
					'manufacturer_img' => $product_manufacturer,
					'manufacturer'     => $result['manufacturer'],
					'manufacturers'    => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $result['manufacturer_id']),
					//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'description' => utf8_substr(strip_tags(html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8')), 0, $this->config->get($this->config->get('config_theme') . '_product_description_length')) . '..',
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            'description' => $result['description'] ? html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8') : false, //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['sorts'] = array();
            ]]></search>
            <add position="replace" offset="56"><![CDATA[
            //mod
			if (isset($this->request->get['manufacturer_id'])) {
				$manufacturer_filter = '&manufacturer_id=' . $this->request->get['manufacturer_id'];
            } else {
				$manufacturer_filter = '';
			}

			if (isset($this->request->get['attribute_filter'])) {
			    $attribute_filter = '';

                foreach ($this->request->get['attribute_filter'] as $key => $attribute_value) {
                    $attribute_filter .= '&attribute_filter[' . $key . ']=' . $attribute_value;
                }
            } else {
                $attribute_filter = '';
            }

		    if (isset($this->request->get['min_price'])) {
                $min_filter_price = '&min_price=' . $this->request->get['min_price'];
            } else {
                $min_filter_price = '';
            }

            if (isset($this->request->get['max_price'])) {
                $max_filter_price = '&max_price=' . $this->request->get['max_price'];
            } else {
                $max_filter_price = '';
            }

            if (isset($this->request->get['in_stock'])) {
				$in_stock_filter = '&in_stock=true';
            } else {
				$in_stock_filter = '';
			}

            $url_filter = array(
                'manufacturer_filter' => $manufacturer_filter,
                'attribute_filter'    => $attribute_filter,
                'min_filter_price'    => $min_filter_price,
                'max_filter_price'    => $max_filter_price,
                'in_stock_filter'     => $in_stock_filter
            );

			if (!$category_info['product_display']) {
			    $data['product_sorts'] = array();

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_default'),
			    	'value' => 'sort_order-ASC',
			    	'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_name_asc'),
			    	'value' => 'name-ASC',
			    	'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=name&order=ASC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_name_desc'),
			    	'value' => 'name-DESC',
			    	'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=name&order=DESC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_price_asc'),
			    	'value' => 'price-ASC',
			    	'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=price&order=ASC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_price_desc'),
			    	'value' => 'price-DESC',
			    	'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=price&order=DESC' . $url . implode('', array_values($url_filter)))
			    );
			}
			//mod
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
            . $url)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            . $url . $in_stock_filter) //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0,2,3,4,5,6,7,8,9,10,11"><![CDATA[
            . $url)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            . $url . $manufacturer_filter . $in_stock_filter) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            . $url . '&limit=' . $value)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            . $url . implode('', array_values($url_filter)) . '&limit=' . $value) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$pagination->url = $this->url->link('product/category', 'path=' . $this->request->get['path'] . $url . '&page={page}');
			]]></search>
            <add position="replace" trim="true"><![CDATA[
            $pagination->url = $this->url->link('product/category', 'path=' . $this->request->get['path'] . $url . implode('', array_values($url_filter)) . '&page={page}'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'] . '&page='. ($page + 1), true), 'next');
            ]]></search>
            <add position="replace" offset="-9"><![CDATA[
            //mod
            if ($page == 1) {
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'], true), 'canonical');
            } elseif ($page == 2) {
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'], true), 'canonical');
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'], true), 'prev');
            } else {
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'], true), 'canonical');
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'] . '&page=' . ($page - 1), true), 'prev');
            }

            if ($limit && ceil($product_total / $limit) > $page) {
                $this->document->addLink($this->url->link('product/category', 'path=' . $category_info['category_id'] . '&page=' . ($page + 1), true), 'next'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['limit'] = $limit;
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $url_filter = array(
                'manufacturer_filter' => $manufacturer_filter,
                'attribute_filter'    => $attribute_filter,
                'min_filter_price'    => $min_filter_price,
                'max_filter_price'    => $max_filter_price
            );

            $data['url'] = html_entity_decode($this->url->link('product/category', 'path=' . $this->request->get['path'] . $url . implode('', array_values($url_filter))), ENT_QUOTES, 'UTF-8');
            $data['in_stock'] = $in_stock;
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->response->setOutput($this->load->view('product/category', $data));
            ]]></search>
            <add position="replace"><![CDATA[
            //mod
            if ($category_info['product_display']) {
                $this->response->setOutput($this->load->view('product/product_category', $data));
			} elseif ($category_info['category_display'] && file_exists(DIR_TEMPLATE  . $this->config->get('config_theme') . '/template/custom/category/' . $category_info['category_display'])) {
                $this->response->setOutput($this->load->view('custom/category/' . $category_info['category_display'], $data));
            } else {
                $this->response->setOutput($this->load->view('product/category', $data));
            }
            //mod
            ]]></add>
        </operation>
    </file>

    <!-- 2. PRODUCT CONTROLLER (Frontend) -->

    <file path="catalog/controller/product/product.php">
        <operation>
            <search index="0"><![CDATA[
		    $this->load->model('catalog/category');
            ]]></search>
            <add position="after"><![CDATA[
		$this->load->model('catalog/parent_product'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $this->document->addScript('catalog/view/javascript/jquery/blueimp/js/blueimp-gallery.min.js');
            $this->document->addStyle('catalog/view/javascript/jquery/blueimp/css/blueimp-gallery.min.css');

            $data['popup_view_data'] = $this->config->get($this->config->get('config_theme') . '_popup_view_data');
            $data['popup_view_text'] = $this->language->load('common/popup_view');
		    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['text_login'] = sprintf($this->language->get('text_login'), $this->url->link('account/login', '', true), $this->url->link('account/register', '', true));
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $data['text_login'] = sprintf($this->language->get('text_login_ajax'), 'getPopupLogin();', $this->url->link('account/register', '', true));
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
            $data['button_continue'] = $this->language->get('button_continue');
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $data['button_no_stock'] = $this->language->get('button_no_stock');
            $data['button_pre_order'] = $this->language->get('button_pre_order');

            $data['stock_checkout'] = $this->config->get('config_stock_checkout');
            $data['stock_display'] = $this->config->get('config_stock_display');
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');
            ]]></search>
            <add position="after"><![CDATA[
            //Product variants
			if (!empty($category_info['product_display']) && $category_info['product_display']) {
			    $data['parent_heading_title'] = $category_info['name'];

			    if ($category_info['image']) {
			        $category_thumb = $this->model_tool_image->resize($category_info['image'], getimagesize(DIR_IMAGE . $category_info['image'])[0], getimagesize(DIR_IMAGE . $category_info['image'])[1]);

				    $data['category_thumb'] = array(
				        'thumb'      => $category_thumb,
				        'background' => '<div style="position: absolute; display: block; width: 100%; height: 100%; bottom: 0; opacity: 0.5; background: url(' . $category_thumb . ') center repeat-x;"></div>'
				    );
	    		} else {
	    		    $data['category_thumb'] = false;
	    		}

	    		$filter_data = array(
	    		    'filter_category_id' => $category_id
	    		);

			    $results = $this->model_catalog_product->getProducts($filter_data);

			    if ($category_info['search_related']) {
			        if ($category_info['search_regex']) {
			            $search_name = preg_replace($category_info['search_regex'], '', $category_info['name']);
                    } else {
			            $search_name = $category_info['name'];
                    }

                    $related_categories = $this->model_catalog_parent_product->getCategoriesByName($search_name, $category_info['category_id']);

                    if ($related_categories) {
                        foreach ($related_categories as $related_category) {
                            $filter_data = array(
                                'filter_category_id' => $related_category['category_id']
                            );

                            $related_results = $this->model_catalog_product->getProducts($filter_data);

                            if ($related_results) {
                                $results = array_merge($results, $related_results);
                            }
                        }
                    }
                }

                if ($results) {
                    $data['product_variants'] = $this->model_catalog_parent_product->getProductVariantsView($product_id, $results, $category_info);
                } else {
                    $data['product_variants'] = false;
                }
			}

            //Information
		    $this->load->model('catalog/information');

		    $data['nav_informations'] = array();

		    foreach ($this->model_catalog_information->getInformations() as $result) {
		    	if ($result['product']) {
		    		$data['nav_informations'][] = array(
		    		    'id'          => $result['information_id'],
		    			'title'       => $result['title'],
		    			'description' =>  html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8')
		    		);
		    	}
		    }
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ($product_info['quantity'] <= 0) {
            ]]></search>
            <add position="before"><![CDATA[
		    $data['stock_qty'] = $product_info['quantity']; //mod
			]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$this->load->model('tool/image');
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            if ($product_info['manufacturer_img']) {
                $data['manufacturer_img'] = $this->model_tool_image->resize($product_info['manufacturer_img'], $this->config->get($this->config->get('config_theme') . '_manufacturer_image_thumb_width'), $this->config->get($this->config->get('config_theme') . '_manufacturer_image_thumb_height'));
            } else {
                $data['manufacturer_img'] = false;
            }
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['popup'] = '';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $data['popup'] = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_popup_width'), $this->config->get($this->config->get('config_theme') . '_image_popup_height')); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['thumb'] = '';
            ]]></search>
            <add position="replace" offset="-3"><![CDATA[
            //mod
            if ($product_info['image'] && $product_info['thumb_width'] && $product_info['thumb_height']) {
                $data['thumb'] = $this->model_tool_image->resize($product_info['image'], $product_info['thumb_width'], $product_info['thumb_height']);
                $data['small_thumb'] = $this->model_tool_image->resize($product_info['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
            } elseif ($product_info['image']) {
				$data['thumb'] = $this->model_tool_image->resize($product_info['image'], $this->config->get($this->config->get('config_theme') . '_image_thumb_width'), $this->config->get($this->config->get('config_theme') . '_image_thumb_height'));
				$data['small_thumb'] = $this->model_tool_image->resize($product_info['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
			} elseif ($product_info['thumb_width'] && $product_info['thumb_height']) {
				$data['thumb'] = $this->model_tool_image->resize('placeholder.png', $product_info['thumb_width'], $product_info['thumb_height']);
				$data['small_thumb'] = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'));
			} else {
				$data['thumb'] = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_thumb_width'), $this->config->get($this->config->get('config_theme') . '_image_thumb_height'));
				$data['small_thumb'] = $this->model_tool_image->resize('placeholder.png', $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height')); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $results = $this->model_catalog_product->getProductImages($this->request->get['product_id']);
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            if ($results && $product_info['image'] && $product_info['thumb_width'] && $product_info['thumb_height']) {
                $big_width = $product_info['thumb_width'];
                $big_height = $product_info['thumb_height'];
            } elseif ($results) {
                $big_width = $this->config->get($this->config->get('config_theme') . '_image_thumb_width');
                $big_height = $this->config->get($this->config->get('config_theme') . '_image_thumb_height');
            }
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'thumb' => $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height'))
            ]]></search>
            <add position="replace"><![CDATA[
                    //mod
                    'thumb'     => $this->model_tool_image->resize($result['image'], $this->config->get($this->config->get('config_theme') . '_image_additional_width'), $this->config->get($this->config->get('config_theme') . '_image_additional_height')),
                    'big_thumb' => $this->model_tool_image->resize($result['image'], $big_width, $big_height)
                    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ((float)$product_info['special']) {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            if ((float)$product_info['special'] && $product_info['quantity'] > 0) {
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$data['special'] = false;
            ]]></search>
            <add position="after" offset="1"><![CDATA[
            //mod
            $special_logged = $this->model_catalog_product->getProductSpecialsLogged($this->request->get['product_id']);

            if ($data['price'] && !empty($special_logged['price']) && $product_info['quantity'] > 0) {
                $data['special_logged'] = sprintf($this->language->get('text_special_logged'), $this->currency->format($this->tax->calculate($data['price'] - $special_logged['price'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']));
            } else {
                $data['special_logged'] = false;
            }
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ((float)$result['special']) {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            if ((float)$result['special'] && $result['quantity'] > 0) { //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
				$data['products'][] = array(
            ]]></search>
            <add position="before"><![CDATA[
                //mod
                $stock = $this->language->get('text_stock') . ' ';
                if ($result['quantity'] <= 0) {
                    $stock .= $result['stock_status'];
                } elseif ($this->config->get('config_stock_display')) {
                    $stock .= $result['quantity'];
                } else {
                    $stock .= $this->language->get('text_instock');
                }

                $product_manufacturer = array();

                if ($result['manufacturer_id']) {
                    $product_manufacturer_info = $this->model_catalog_manufacturer->getManufacturer($result['manufacturer_id']);

                    if ($product_manufacturer_info['image']) {
                        $logo = $this->model_tool_image->resize($product_manufacturer_info['image'], $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_width'), $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_height'));
                    } else {
                        $logo = false;
                    }

                    $product_manufacturer = array(
                        'name'            => $product_manufacturer_info['name'],
                        'logo'            => $logo,
                        'id'              => $product_manufacturer_info['manufacturer_id'],
                        'href'            => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $product_manufacturer_info['manufacturer_id'])
                    );
                }
                //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'rating'      => $rating,
            ]]></search>
            <add position="after"><![CDATA[
                    //mod
                    'stock'       => $stock,
                    'stock_qty'   => $result['quantity'],
                    'manufacturer' => $product_manufacturer,
                    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->response->setOutput($this->load->view('product/product', $data));
            ]]></search>
            <add position="replace"><![CDATA[
            //mod
            if (!empty($category_info['product_display']) && $category_info['product_display'] && file_exists(DIR_TEMPLATE  . $this->config->get('config_theme') . '/template/custom/product/' . $category_info['product_display'])) {
                $this->response->setOutput($this->load->view('custom/product/' . $category_info['product_display'], $data));
            } else {
                $this->response->setOutput($this->load->view('product/product', $data));
            }
            //mod
            ]]></add>
        </operation>
    </file>

    <!-- 3. MANUFACTURER CONTROLLER (Frontend) -->

    <file path="catalog/controller/product/manufacturer.php">
        <operation>
            <search index="1"><![CDATA[
            $this->load->model('tool/image');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $this->load->model('catalog/parent_product');

        $this->document->addStyle('catalog/view/javascript/jquery/slick/slick.css');
		$this->document->addStyle('catalog/view/javascript/jquery/slick/slick-theme.css');
		$this->document->addScript('catalog/view/javascript/jquery/slick/slick.min.js');

        $data['popup_view_data'] = $this->config->get($this->config->get('config_theme') . '_popup_view_data');
        $data['popup_view_text'] = $this->language->load('common/popup_view');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
		    if (isset($this->request->get['sort'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->get['in_stock'])) {
            $in_stock = $this->request->get['in_stock'];
        } else {
            $in_stock = '';
        }

        if (isset($this->request->get['min_price'])) {
            $min_price = $this->request->get['min_price'];
        } else {
            $min_price = '';
        }

        if (isset($this->request->get['max_price'])) {
            $max_price = $this->request->get['max_price'];
        } else {
            $max_price = '';
        }
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $sort = 'p.sort_order';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $sort = 'p.quantity'; //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $order = 'ASC';
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $order = 'DESC'; //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['text_limit'] = $this->language->get('text_limit');
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $data['text_loading'] = $this->language->get('text_loading');

            $data['button_no_stock'] = $this->language->get('button_no_stock');
            $data['button_pre_order'] = $this->language->get('button_pre_order');

            $data['stock_checkout'] = $this->config->get('config_stock_checkout');
            $data['stock_display'] = $this->config->get('config_stock_display');

            $data['entry_in_stock'] = $this->language->get('entry_in_stock');
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
				'filter_manufacturer_id' => $manufacturer_id,
            ]]></search>
            <add position="after"><![CDATA[
                'filter_in_stock'        => $in_stock, //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['products'] = array();
            ]]></search>
            <add position="before"><![CDATA[
            //mod
			if ($manufacturer_info['manufacturer_display']) {
                $this->load->model('catalog/category');

                if ($manufacturer_info['image']) {
                    $data['manufacturer_logo'] = array (
                        'image' => $this->model_tool_image->resize($manufacturer_info['image'], $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_width'), $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_height')),
                        'name'  => !empty($manufacturer_info['meta_h1']) ? $manufacturer_info['meta_h1'] : $manufacturer_info['name']
                    );
                } else {
                    $data['manufacturer_logo'] = false;
                }

                $data['parents_categories'] = array();

                $manufacturer_category_limit = 5;

                $filter_data = array(
                    'filter_manufacturer_id' => $manufacturer_id,
                    'filter_in_stock'        => $in_stock,
                    'filter_min_price'       => $min_price,
                    'filter_max_price'       => $max_price,
                    'start'                  => ($page - 1) * $manufacturer_category_limit,
                    'limit'                  => $manufacturer_category_limit,
                );

                $parents_categories = $this->model_catalog_parent_product->getParentInfoManufacturerProductsAnyType($filter_data);
                $parents_categories_total = $this->model_catalog_parent_product->getTotalParentInfoManufacturerProductsAnyType($filter_data);

                if ($parents_categories) {
                    $filter_data = array(
                        'filter_manufacturer_id' => $manufacturer_id,
                        'filter_in_stock'        => $in_stock,
                        'filter_min_price'       => $min_price,
                        'filter_max_price'       => $max_price,
                        'sort'                   => $sort,
                        'order'                  => $order
                    );

                    foreach ($parents_categories as $parent_category) {
                        $filter_data['filter_category_id'] = $parent_category['id']; //add $filter_data element

                        $results = $this->model_catalog_parent_product->getProductsAnyType($filter_data);

                        $products_any_type = $this->model_catalog_parent_product->getProductsAnyTypeView($products_type = 'products_manufacturer', $results, $category_info = false, $url, $in_stock, $data, $filter_data);

                        if ($products_any_type) {
                            $data['parents_categories'][] = array(
                                'name'          => $parent_category['name'],
                                'link'          => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $manufacturer_id . '&category_id=' . $parent_category['id'])  . '#' . $parent_category['id'],
                                'category_id'   => $parent_category['id'],
                                'products'      => $products_any_type
                            );
                        }
                    }
                }

                $data['filter_price'] = $data['parents_categories'] ? $this->load->controller('common/filter/filter_price', $filter_data) : '';
                $data['filter_selected'] = $this->load->controller('common/filter/filter_selected', $this->request->get);
            }
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $product_total = $this->model_catalog_product->getTotalProducts($filter_data);
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $product_total = !$manufacturer_info['manufacturer_display'] ? $this->model_catalog_product->getTotalProducts($filter_data) : '0'; //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $results = $this->model_catalog_product->getProducts($filter_data);
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $results = !$manufacturer_info['manufacturer_display'] ? $this->model_catalog_product->getProducts($filter_data) : array(); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['products'][] = array(
            ]]></search>
            <add position="before"><![CDATA[
                //mod
                $stock = $this->language->get('text_stock') . ' ';
			    if ($result['quantity'] <= 0) {
			        $stock .= $result['stock_status'];
			    } elseif ($this->config->get('config_stock_display')) {
			        $stock .= $result['quantity'];
			    }
			    $stock_qty = $result['quantity'];
			    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'price'       => $price,
            ]]></search>
            <add position="after"><![CDATA[
                    //mod
                    'stock'       => $stock,
                    'stock_qty'   => $stock_qty,
                    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['sorts'] = array();
            ]]></search>
            <add position="before"><![CDATA[
            //mod
            if ($manufacturer_info['manufacturer_display']) {
		        if (isset($this->request->get['min_price'])) {
                    $min_filter_price = '&min_price=' . $this->request->get['min_price'];
                } else {
                    $min_filter_price = '';
                }

                if (isset($this->request->get['max_price'])) {
                    $max_filter_price = '&max_price=' . $this->request->get['max_price'];
                } else {
                    $max_filter_price = '';
                }

                if (isset($this->request->get['in_stock'])) {
			    	$in_stock_filter = '&in_stock=true';
                } else {
			    	$in_stock_filter = '';
			    }

                $url_filter = array(
                    'min_filter_price'    => $min_filter_price,
                    'max_filter_price'    => $max_filter_price,
                    'in_stock_filter'     => $in_stock_filter
                );

			    $data['product_sorts'] = array();

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_default'),
			    	'value' => 'sort_order-ASC',
			    	'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_name_asc'),
			    	'value' => 'name-ASC',
			    	'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=name&order=ASC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_name_desc'),
			    	'value' => 'name-DESC',
			    	'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=name&order=DESC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_price_asc'),
			    	'value' => 'price-ASC',
			    	'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=price&order=ASC' . $url . implode('', array_values($url_filter)))
			    );

			    $data['product_sorts'][] = array(
			    	'text'  => $this->language->get('text_price_desc'),
			    	'value' => 'price-DESC',
			    	'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=price&order=DESC' . $url . implode('', array_values($url_filter)))
			    );
			}
			//mod
            ]]></add>
        </operation>
        <operation>
            <search index="2,3,4,5,6,7,8,9,10"><![CDATA[
			. $url)
			]]></search>
            <add position="replace" trim="true"><![CDATA[
            . $url . $in_stock_filter) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			$pagination = new Pagination();
            ]]></search>
            <add position="replace" offset="21"><![CDATA[
            //mod
            if ($manufacturer_info['manufacturer_display']) {
                $pagination = new Pagination();
                $pagination->total = $parents_categories_total;
                $pagination->page = $page;
                $pagination->limit = $manufacturer_category_limit;
                $pagination->url = $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] .  $url . implode('', array_values($url_filter)) . '&page={page}');

                $data['pagination'] = $pagination->render();

                $data['results'] = sprintf($this->language->get('text_pagination'), ($parents_categories_total) ? (($page - 1) * $manufacturer_category_limit) + 1 : 0, ((($page - 1) * $manufacturer_category_limit) > ($parents_categories_total - $manufacturer_category_limit)) ? $parents_categories_total : ((($page - 1) * $manufacturer_category_limit) + $manufacturer_category_limit), $parents_categories_total, ceil($parents_categories_total / $manufacturer_category_limit));

                // http://googlewebmastercentral.blogspot.com/2011/09/pagination-with-relnext-and-relprev.html
                if ($page == 1) {
                    $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'], true), 'canonical');
                } elseif ($page == 2) {
                    $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'], true), 'prev');
                } else {
                    $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . '&page='. ($page - 1), true), 'prev');
                }

                if ($limit && ceil($product_total / $limit) > $page) {
                    $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . '&page='. ($page + 1), true), 'next');
                }
			} else {
			    $pagination = new Pagination();
			    $pagination->total = $product_total;
			    $pagination->page = $page;
			    $pagination->limit = $limit;
			    $pagination->url = $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] .  $url . '&page={page}');

			    $data['pagination'] = $pagination->render();

			    $data['results'] = sprintf($this->language->get('text_pagination'), ($product_total) ? (($page - 1) * $limit) + 1 : 0, ((($page - 1) * $limit) > ($product_total - $limit)) ? $product_total : ((($page - 1) * $limit) + $limit), $product_total, ceil($product_total / $limit));

			    // http://googlewebmastercentral.blogspot.com/2011/09/pagination-with-relnext-and-relprev.html
			    if ($page == 1) {
			        $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'], true), 'canonical');
			    } elseif ($page == 2) {
			        $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'], true), 'prev');
			    } else {
			        $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . '&page='. ($page - 1), true), 'prev');
			    }

			    if ($limit && ceil($product_total / $limit) > $page) {
			        $this->document->addLink($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . '&page='. ($page + 1), true), 'next');
			    }
			}
			//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['limit'] = $limit;
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            $url_filter = array(
                'min_filter_price'    => $min_filter_price,
                'max_filter_price'    => $max_filter_price
            );

            $data['url'] = html_entity_decode($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . $url . implode('', array_values($url_filter))), ENT_QUOTES, 'UTF-8');
            $data['in_stock'] = $in_stock;
            //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->response->setOutput($this->load->view('product/manufacturer_info', $data));
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            //mod
            if ($manufacturer_info['manufacturer_display'] && file_exists(DIR_TEMPLATE  . $this->config->get('config_theme') . '/template/custom/manufacturer/' . $manufacturer_info['manufacturer_display'])) {
                $this->response->setOutput($this->load->view('custom/manufacturer/' . $manufacturer_info['manufacturer_display'], $data));
            } else {
                $this->response->setOutput($this->load->view('product/manufacturer_info', $data));
            }
            //mod
            ]]></add>
        </operation>
    </file>

    <!-- 4. SPECIAL CONTROLLER (Frontend) -->

    <file path="catalog/controller/product/special.php">
        <operation>
            <search><![CDATA[
		    $this->load->model('catalog/product');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $this->load->model('catalog/manufacturer');
        $this->load->model('catalog/parent_product');

        $this->load->model('tool/image');

        $this->document->addStyle('catalog/view/javascript/jquery/slick/slick.css');
		$this->document->addStyle('catalog/view/javascript/jquery/slick/slick-theme.css');
		$this->document->addScript('catalog/view/javascript/jquery/slick/slick.min.js');

        $data['popup_view_data'] = $this->config->get($this->config->get('config_theme') . '_popup_view_data');
        $data['popup_view_text'] = $this->language->load('common/popup_view');
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index=""><![CDATA[
		    $sort = $this->request->get['sort'];
            ]]></search>
            <add position="before" offset="1"><![CDATA[
        //mod
        if (isset($this->request->get['manufacturer_id'])) {
            $manufacturer_id = $this->request->get['manufacturer_id'];
        } else {
            $manufacturer_id = '';
        }

        if (isset($this->request->get['min_price'])) {
            $min_price = $this->request->get['min_price'];
        } else {
            $min_price = '';
        }

        if (isset($this->request->get['max_price'])) {
            $max_price = $this->request->get['max_price'];
        } else {
            $max_price = '';
        }
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
			$url .= '&sort=' . $this->request->get['sort'];
            ]]></search>
            <add position="before" offset="1"><![CDATA[
        //mod
        if (isset($this->request->get['manufacturer_id'])) {
            $url .= '&manufacturer_id=' . $this->request->get['manufacturer_id'];
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['text_limit'] = $this->language->get('text_limit');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['text_stock'] = $this->language->get('text_stock');
        $data['text_discount'] = $this->language->get('text_discount');
        $data['text_points'] = $this->language->get('text_points');
        $data['text_to_manufacturer_page'] = $this->language->get('text_to_manufacturer_page');
        $data['text_filter_manufacturer'] = $this->language->get('text_filter_manufacturer');
        $data['text_loading'] = $this->language->get('text_loading');

        $data['button_pre_order'] = $this->language->get('text_pre_order');

        $data['entry_in_stock'] = $this->language->get('entry_in_stock');

        $data['stock_checkout'] = $this->config->get('config_stock_checkout');
        $data['stock_display'] = $this->config->get('config_stock_display');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['products'] = array();
            ]]></search>
            <add position="replace" offset="56"><![CDATA[
        //mod
        if (isset($this->request->get['sort'])) {
			$sort_url = '&sort=' . $this->request->get['sort'];
		} else {
		    $sort_url = '';
		}

		if (isset($this->request->get['order'])) {
			$order_url = '&order=' . $this->request->get['order'];
		} else {
		    $order_url = '';
		}

        $filter_data = array (
            'filter_manufacturer_id' => $manufacturer_id,
            'filter_in_stock'        => true,
            'filter_special'         => true,
            'filter_min_price'       => $min_price,
            'filter_max_price'       => $max_price,
            'sort'                   => $sort,
            'order'                  => $order,
            'start'                  => ($page - 1) * $limit,
            'limit'                  => $limit
        );

        $results = $this->model_catalog_parent_product->getSpecialProductsAnyType($filter_data);

        $results_total = $this->model_catalog_parent_product->getTotalSpecialProductsAnyType($filter_data);

        if ($results) {
            $data['special_products'] = $this->model_catalog_parent_product->getProductsAnyTypeView($products_type = 'products_special', $results, $category_info = false, $url, $in_stock = true, $data, $filter_data);
        } else {
            $data['special_products'] = false;
        }

        $product_total = $results_total;

        $data['filter_manufacturer'] = $this->load->controller('common/filter/filter_manufacturer', $filter_data);
        $data['filter_price'] = $this->load->controller('common/filter/filter_price', $filter_data);
        $data['filter_selected'] = $this->load->controller('common/filter/filter_selected', $this->request->get);
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		$data['sorts'] = array();
            ]]></search>
            <add position="replace" offset="56"><![CDATA[
        //mod
		if (isset($this->request->get['manufacturer_id'])) {
			$manufacturer_filter = '&manufacturer_id=' . $this->request->get['manufacturer_id'];
        } else {
			$manufacturer_filter = '';
		}

		if (isset($this->request->get['min_price'])) {
            $min_filter_price = '&min_price=' . $this->request->get['min_price'];
        } else {
            $min_filter_price = '';
        }

        if (isset($this->request->get['max_price'])) {
            $max_filter_price = '&max_price=' . $this->request->get['max_price'];
        } else {
            $max_filter_price = '';
        }

        $url_filter = array(
            'manufacturer_filter' => $manufacturer_filter,
            'min_filter_price'    => $min_filter_price,
            'max_filter_price'    => $max_filter_price
        );

		$data['product_sorts'] = array();

		$data['product_sorts'][] = array(
			'text'  => $this->language->get('text_default'),
			'value' => 'sort_order-ASC',
			'href'  => $this->url->link('product/special', $url . implode('', array_values($url_filter)))
		);

		$data['product_sorts'][] = array(
			'text'  => $this->language->get('text_name_asc'),
			'value' => 'name-ASC',
			'href'  => $this->url->link('product/special', 'sort=name&order=ASC' . $url . implode('', array_values($url_filter)))
		);

		$data['product_sorts'][] = array(
			'text'  => $this->language->get('text_name_desc'),
			'value' => 'name-DESC',
			'href'  => $this->url->link('product/special', 'sort=name&order=DESC' . $url . implode('', array_values($url_filter)))
		);

		$data['product_sorts'][] = array(
			'text'  => $this->language->get('text_price_asc'),
			'value' => 'price-ASC',
			'href'  => $this->url->link('product/special', 'sort=price&order=ASC' . $url . implode('', array_values($url_filter)))
		);

		$data['product_sorts'][] = array(
			'text'  => $this->language->get('text_price_desc'),
			'value' => 'price-DESC',
			'href'  => $this->url->link('product/special', 'sort=price&order=DESC' . $url . implode('', array_values($url_filter)))
		);
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $url . '&limit=' . $value)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $url . implode('', array_values($url_filter)) . '&limit=' . $value) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $url . '&page={page}');
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $url . implode('', array_values($url_filter)) . '&page={page}'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $this->document->addLink($this->url->link('product/special', 'page='. ($page + 1), true), 'next');
            ]]></search>
            <add position="replace" offset="-9"><![CDATA[
        //mod
		if ($page == 1) {
		    $this->document->addLink($this->url->link('product/special', '', true), 'canonical');
		} elseif ($page == 2) {
		    $this->document->addLink($this->url->link('product/special', '', true), 'canonical');
		    $this->document->addLink($this->url->link('product/special', '', true), 'prev');
		} else {
		    $this->document->addLink($this->url->link('product/special', '', true), 'canonical');
		    $this->document->addLink($this->url->link('product/special', 'page='. ($page - 1), true), 'prev');
		}

		if ($limit && ceil($product_total / $limit) > $page) {
		    $this->document->addLink($this->url->link('product/special', 'page='. ($page + 1), true), 'next'); //mod
            ]]></add>
        </operation>
    </file>

    <!-- 5. SEARCH CONTROLLER (Frontend) -->

    <file path="catalog/controller/product/search.php">
        <operation>
            <search><![CDATA[
            if (isset($this->request->get['search']) || isset($this->request->get['tag'])) {
            ]]></search>
            <add position="after"><![CDATA[
            $this->load->model('catalog/manufacturer');
            $this->load->model('catalog/parent_product');

            $data['popup_view_data'] = $this->config->get($this->config->get('config_theme') . '_popup_view_data');
            $data['popup_view_text'] = $this->language->load('common/popup_view');
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'filter_sub_category' => $sub_category,
            ]]></search>
            <add position="after"><![CDATA[
				'filter_in_stock'     => $in_stock, //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['products'][] = array(
            ]]></search>
            <add position="before"><![CDATA[
                //mod
                $special_logged_info = $this->model_catalog_product->getProductSpecialsLogged($result['product_id']);

                if (!empty($special_logged_info['price']) && $result['quantity'] > 0) {
                    $special_logged_text = sprintf($this->language->get('text_special_logged'), $this->currency->format($this->tax->calculate($result['price'] - $special_logged_info['price'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']));
                    $special_percent = round(($result['price'] - $special_logged_info['price']) / ($result['price']/100)) . '%';
                } elseif ((float)$result['special'] && $result['quantity'] > 0) {
                    $special_logged_text = false;
                    $special_percent = round(($result['price'] - $result['special']) / ($result['price']/100)) . '%';
                } else {
                    $special_logged_text = false;
                    $special_percent = false;
                }

                $product_stock = $this->language->get('text_stock') . ' ';
                if ($result['quantity'] <= 0) {
                    $product_stock .= $result['stock_status'];
                } elseif ($this->config->get('config_stock_display')) {
                    $product_stock .= $result['quantity'];
                }

                $product_manufacturer = array();

                if ($result['manufacturer_id']) {
                    $product_manufacturer_info = $this->model_catalog_manufacturer->getManufacturer($result['manufacturer_id']);

                    if ($product_manufacturer_info['image']) {
                        $logo = $this->model_tool_image->resize($product_manufacturer_info['image'], $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_width'), $this->config->get($this->config->get('config_theme') . '_manufacturer_image_product_height'));
                    } else {
                        $logo = false;
                    }

                    $product_manufacturer = array(
                        'name'            => $product_manufacturer_info['name'],
                        'image'           => $logo,
                        'id'              => $product_manufacturer_info['manufacturer_id'],
                        'href'            => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $product_manufacturer_info['manufacturer_id'])
                    );
                }

                $data['filter_selected'] = $this->load->controller('common/filter/filter_selected', $this->request->get);
                //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'name'        => $result['name'],
            ]]></search>
            <add position="after"><![CDATA[
                    //mod
                    'special_percent'  => $special_logged_text ? $special_logged_text : $special_percent,
                    'stock'            => $product_stock,
                    'stock_qty'        => $result['quantity'],
                    'manufacturer'     => $product_manufacturer,
                    //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            'href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            'href'        => $this->url->link('product/product', 'product_id=' . $result['product_id']) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['entry_description'] = $this->language->get('entry_description');
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['text_to_manufacturer_page'] = $this->language->get('text_to_manufacturer_page');
        $data['text_loading'] = $this->language->get('text_loading');

        $data['entry_in_stock'] = $this->language->get('entry_in_stock');

        $data['stock_checkout'] = $this->config->get('config_stock_checkout');
        $data['stock_display'] = $this->config->get('config_stock_display');

        $data['button_no_stock'] = $this->language->get('button_no_stock');
        $data['button_pre_order'] = $this->language->get('button_pre_order');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
            if (isset($this->request->get['search'])) {
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        if (isset($this->request->get['in_stock'])) {
            $in_stock = $this->request->get['in_stock'];
        } else {
            $in_stock = '';
        }
        //mod
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[
            $url = '';
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        if (isset($this->request->get['in_stock'])) {
			$in_stock_filter = '&in_stock=true';
        } else {
			$in_stock_filter = '';
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search index="1,2,3"><![CDATA[
            $url = '';
            ]]></search>
            <add position="after"><![CDATA[
            //mod
            if (isset($this->request->get['in_stock'])) {
				$in_stock_filter = '&in_stock=true';
            } else {
				$in_stock_filter = '';
			}
			//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $url)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $url . $in_stock_filter) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $url . '&limit=' . $value)
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $url . '&limit=' . $value . $in_stock_filter) //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $url . '&page={page}');
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            $url . '&page={page}' . $in_stock_filter); // mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['sort'] = $sort;
            ]]></search>
            <add position="before"><![CDATA[
        //mod
        $data['url'] = html_entity_decode($this->url->link('product/search', $url), ENT_QUOTES, 'UTF-8');
        $data['in_stock'] = $in_stock;
        //mod
            ]]></add>
        </operation>
        <operation>
            <search index="1"><![CDATA[
            if ($this->config->get('config_review_status')) {
            ]]></search>
            <add position="replace" offset="24"><![CDATA[
            //Delete //mod
            ]]></add>
        </operation>
    </file>

    <!-- 6. FEATURED MODULE CONTROLLER (Frontend) -->

    <file path="catalog/controller/extension/module/featured.php">
        <operation>
            <search><![CDATA[
		    $data['heading_title'] = $this->language->get('heading_title');
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        $data['heading_title'] = $setting['heading'] ? $setting['name'] : $this->language->get('heading_title');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if (!empty($setting['product'])) {
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        if ($setting['category_selected']) {
            $data['category_url'] = sprintf($this->language->get('text_category_url'), 'index.php?route=product/category&path=' . $setting['category_selected']);

    	    $filter_data = array(
	            'filter_category_id'  => $setting['category_selected'],
	            'filter_sub_category' => true,
                'limit'               => $setting['limit'],
                'start'               => 0
            );

            $products = $this->model_catalog_product->getProducts($filter_data);

            if ($products) {
                foreach ($products as $product) {
                    if ($product['image']) {
                    $image = $this->model_tool_image->resize($product['image'], $setting['width'], $setting['height']);
                    } else {
                        $image = $this->model_tool_image->resize('placeholder.png', $setting['width'], $setting['height']);
                    }

                    if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {
                        $price = $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
                    } else {
                        $price = false;
                    }

                    if ((float)$product['special']) {
                        $special = $this->currency->format($this->tax->calculate($product['special'], $product['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
                    } else {
                        $special = false;
                    }

                    if ($this->config->get('config_tax')) {
                        $tax = $this->currency->format((float)$product['special'] ? $product['special'] : $product['price'], $this->session->data['currency']);
                    } else {
                        $tax = false;
                    }

                    if ($this->config->get('config_review_status')) {
                        $rating = $product['rating'];
                    } else {
                        $rating = false;
                    }

                    $data['products'][] = array(
                        'product_id' => $product['product_id'],
                        'thumb' => $image,
                        'name' => $product['name'],
                        'description' => utf8_substr(strip_tags(html_entity_decode($product['description'], ENT_QUOTES, 'UTF-8')), 0, $this->config->get($this->config->get('config_theme') . '_product_description_length')) . '..',
                        'price' => $price,
                        'special' => $special,
                        'tax' => $tax,
                        'minimum' => $product['minimum'] > 0 ? $product['minimum'] : 1,
                        'rating' => $rating,
                        'href' => $this->url->link('product/product', 'product_id=' . $product['product_id'])
                    );
                }
            }
        } elseif (!empty($setting['product'])) { //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ($data['products']) {
            ]]></search>
            <add position="replace"><![CDATA[
        //mod
        if (($data['products'] || $setting['category_selected']) && $setting['display'] && file_exists(DIR_TEMPLATE  . $this->config->get('config_theme') . '/template/custom/module/' . $setting['display'])) {
            return $this->load->view('custom/module/featured' . $setting['display'], $data);
        } elseif ($data['products'] || $setting['category_selected']) { //mod
            ]]></add>
        </operation>
    </file>

    <!-- 7. HEADER CONTROLLER (Frontend) -->

    <file path="catalog/controller/common/header.php">
        <operation>
            <search><![CDATA[
            if ($this->config->get($analytic['code'] . '_status')) {
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            if ($analytic['code'] == 'google_analytics' && $this->config->get($analytic['code'] . '_status')) { //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['categories'] = array();
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		if (isset($this->request->get['path'])) {
		    $get_parts = explode('_', (string)$this->request->get['path']);

            $category_id = (int)array_pop($get_parts);

            $parts = array();

            $full_path = $this->model_catalog_category->getFullBreadcrumbPath($category_id);

            for ($i = 0; $i < count($full_path); $i++) {
                $parts[] = $full_path[$i]['path_id'];
            }
		} elseif (isset($this->request->get['product_id'])) {
		    $this->load->model('catalog/parent_product');

		    $category_id_info = $this->model_catalog_parent_product->getParentCategoryId($this->request->get['product_id']);

		    if ($category_id_info) {
		        $parts = array();

                $full_path = $this->model_catalog_category->getFullBreadcrumbPath($category_id_info['category_id']);

                for ($i = 0; $i < count($full_path); $i++) {
                    $parts[] = $full_path[$i]['path_id'];
                }
		    }
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['language'] = $this->load->controller('common/language');
            ]]></search>
            <add position="before"><![CDATA[
        //mod
		$this->load->model('catalog/information');

		$data['informations'] = array();

		foreach ($this->model_catalog_information->getInformations() as $result) {
			if ($result['top']) {
				$data['informations'][] = array(
					'title' => $result['title'],
					'href'  => $this->url->link('information/information', 'information_id=' . $result['information_id'])
				);
			}
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
			'name'     => $category['name'],
            ]]></search>
            <add position="after"><![CDATA[
					'active'   => (!empty($parts) && in_array($category['category_id'], $parts)) ? true : false, //mod
            ]]></add>
        </operation>
    </file>

   <!-- 8. FOOTER CONTROLLER (Frontend) -->

    <file path="catalog/controller/common/footer.php">
        <operation>
            <search><![CDATA[
            $data['scripts'] = $this->document->getScripts('footer');
            ]]></search>
            <add position="after"><![CDATA[
		//mod
		// Analytics
		$this->load->model('extension/extension');

		$data['analytics'] = array();

		$analytics = $this->model_extension_extension->getExtensions('analytics');

		foreach ($analytics as $analytic) {
			if ($analytic['code'] == 'yandex_metrics' && $this->config->get($analytic['code'] . '_status')) {
				$data['analytics'][] = $this->load->controller('extension/analytics/' . $analytic['code'], $this->config->get($analytic['code'] . '_status'));
			}
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['text_newsletter'] = $this->language->get('text_newsletter');
            ]]></search>
            <add position="after"><![CDATA[
		$data['text_catalog'] = $this->language->get('text_catalog'); //mod
        $data['text_public_offer'] = $this->language->get('text_public_offer'); //mod
        $data['text_open_map'] = $this->language->get('text_open_map'); //mod
        $data['text_close_map'] = $this->language->get('text_close_map'); //mod
        $data['text_contacts'] = $this->language->get('text_contacts'); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $data['newsletter'] = $this->url->link('account/newsletter', '', true);
            ]]></search>
            <add position="after"><![CDATA[
        //mod
        $data['catalog'] = $this->url->link('product/catalog');
        $data['name'] = $this->config->get('config_name');
        $data['address'] = nl2br($this->config->get('config_address'));
        $data['telephone'] = $this->config->get('config_telephone');
        $data['open'] = nl2br($this->config->get('config_open'));
        $data['email'] = $this->config->get('config_email');
        //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $this->load->model('catalog/information');
            ]]></search>
            <add position="before"><![CDATA[
		//mod
		$this->document->addStyle('catalog/view/javascript/jquery/magnific/magnific-popup.css');
        $this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');

        $this->document->addStyle('catalog/view/javascript/jquery/owl-carousel/owl.carousel.css');
		$this->document->addScript('catalog/view/javascript/jquery/owl-carousel/owl.carousel.min.js');

        $this->document->addStyle('catalog/view/javascript/jquery/flexslider/flexslider.css');
        $this->document->addScript('catalog/view/javascript/jquery/flexslider/jquery.flexslider-min.js');

        $this->document->addStyle('catalog/view/theme/dm_project/stylesheet/popup_view/fastview.css');

        $data['map_data'] = $this->config->get($this->config->get('config_theme') . '_map_data');

		if ($this->request->server['HTTPS']) {
			$server = $this->config->get('config_ssl');
		} else {
			$server = $this->config->get('config_url');
		}

		if (is_file(DIR_IMAGE . $this->config->get('config_logo_footer'))) {
			$data['logo'] = $server . 'image/' . $this->config->get('config_logo_footer');
		} else {
			$data['logo'] = '';
		}

		$this->load->model('catalog/category');

		$data['categories'] = array();

		$categories = $this->model_catalog_category->getCategories(0);

		foreach ($categories as $category) {
			if ($category['top']) {
				$data['categories'][] = array(
					'name'     => $category['name'],
					'href'     => $this->url->link('product/category', 'path=' . $category['category_id'])
				);
			}
		}
		//mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		    $data['informations'] = array();
            ]]></search>
            <add position="after"><![CDATA[
		$data['informations_help'] = array(); //mod
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            if ($result['bottom']) {
            ]]></search>
            <add position="replace"><![CDATA[
            if ($result['bottom_help']) {
				$data['informations_help'][] = array(
					'title' => $result['title'],
					'href'  => $this->url->link('information/information', 'information_id=' . $result['information_id'])
				);
			} elseif ($result['bottom']) { //mod
            ]]></add>
        </operation>
    </file>

    <!-- 9. HOME CONTROLLER (Frontend) -->

    <file path="catalog/controller/common/home.php">
        <operation>
            <search><![CDATA[
		    $data['content_top'] = $this->load->controller('common/content_top');
            ]]></search>
            <add position="after"><![CDATA[
        $data['content_middle'] = $this->load->controller('common/content_middle'); //mod
            ]]></add>
        </operation>
    </file>

    <!-- *** //END CONTROLLER (Frontend)// *** -->



    <!-- START TEMPLATE (Frontend) -->

    <!-- MANUFACTURER TEMPLATE (Frontend) -->

    <file path="catalog/view/theme/*/template/product/manufacturer_info.tpl">
        <operation>
            <search><![CDATA[
            <?php if ($product['price']) { ?>
            ]]></search>
            <add position="before"><![CDATA[
            <?php if ($stock_display) { ?>
                <p><?php echo $product['stock']; ?></p>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            <button type="button" onclick="cart.add('<?php echo $product['product_id']; ?>', '<?php echo $product['minimum']; ?>');"><i class="fa fa-shopping-cart"></i> <span class="hidden-xs hidden-sm hidden-md"><?php echo $button_cart; ?></span></button>
            ]]></search>
            <add position="replace" trim="true"><![CDATA[
            <?php if ($product['stock_qty'] > 0) { ?>
			    <button type="button" onclick="cart.add('<?php echo $product['product_id']; ?>', '<?php echo $product['minimum']; ?>');"><i class="fa fa-shopping-cart"></i> <?php echo $button_cart; ?></button>
            <?php } elseif ($stock_checkout) { ?>
                <button type="button" onclick="cart.add('<?php echo $product['product_id']; ?>', '<?php echo $product['minimum']; ?>');"><i class="fa fa-shopping-cart"></i> <?php echo $button_pre_order; ?></button>
            <?php } else { ?>
			    <button type="button" class="nostock-btn"><i class="fa fa-info" aria-hidden="true"></i> <?php echo $button_no_stock; ?></button>
			<?php } ?>
			]]></add>
        </operation>
    </file>

    <!-- //END TEMPLATE (Frontend)// -->

    <!-- ======================================= //END FRONTEND// ======================================= -->

</modification>
